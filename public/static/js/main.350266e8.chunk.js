(window["webpackJsonpdigital-circuitboard"]=window["webpackJsonpdigital-circuitboard"]||[]).push([[0],{39:function(e){e.exports=JSON.parse('{"main-menu":{"options":{"save-as-svg":"Save as SVG","save-as-png":"Save as PNG","file":{"new":"New","open":"Open","save":"Save"}},"export":"Export","file":"File"},"action":{"create-out-contact":"Create out contact","create-button":"Create button","edit":"Edit","interact":"Interact"},"properties":"{{element}} properties","value":"Value","name":"Name","yes":"Yes","no":"No","elements":{"and":"AND","buffer":"Buffer","button":"Button","constant":"Constant","invertor":"Invertor","nand":"NAND","nor":"NOR","nxor":"NXOR","or":"OR","outcontact":"Out contact","xor":"XOR"},"error":"Error","gdrive":{"error":{"code":"Invalid Code","file-loading":"Error loading file","file-save":"Error saving file to Google Drive","login":"Auth failed","logout":"Logout failed","unknown":"Google Drive Service Unavailable"},"fs":{"empty":"Current folder is empty","login-message":"You should log in to Google to access drive","success-save":"File saved to Google Drive","upper":"To upper level","warning":"Please sign in to Google Drive"},"login":"Sign in","logout":"Sign out","manage":"Manage account","paste":"Paste your code here:","submit":"Submit","success":{"login":"Successfully Logged in to Google Account","logout":"Log out successful"},"title":"Google account management"},"groups":{"base":"Base","gates":"Gates","io":"Input/Output"},"loading":"Loading","loading-file":"Loading {{file}}","notice":"Notice","props":{"color":"Color","current-value":"Current value","in":"Number of In contacts","initial-value":"Initial value","invert":"Invert"},"select-language":"Select language","warning":"Warning!"}')},40:function(e){e.exports=JSON.parse('{"main-menu":{"options":{"save-as-svg":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a SVG","save-as-png":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u0430\u043a PNG","file":{"new":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c","open":"\u041e\u0442\u043a\u0440\u044b\u0442\u044c","save":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"}},"export":"\u042d\u043a\u0441\u043f\u043e\u0440\u0442","file":"\u0424\u0430\u0439\u043b"},"action":{"create-out-contact":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u044b\u0445\u043e\u0434\u044f\u0449\u0438\u0439 \u043a\u043e\u043d\u0442\u0430\u043a\u0442","create-button":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u043d\u043e\u043f\u043a\u0443","edit":"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c","interact":"\u0412\u0437\u0430\u0438\u043c\u043e\u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c"},"properties":"\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430: {{element}}","value":"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435","name":"\u0418\u043c\u044f","yes":"\u0414\u0430","no":"\u041d\u0435\u0442","elements":{"and":"\u0418","buffer":"\u0428\u0438\u043d\u0430","button":"\u041a\u043d\u043e\u043f\u043a\u0430","constant":"\u041a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430","invertor":"\u0418\u043d\u0432\u0435\u0440\u0442\u043e\u0440","nand":"\u0418-\u041d\u0415","nor":"\u0418\u041b\u0418-\u041d\u0415","nxor":"\u0418\u0441\u043a\u043b\u044e\u0447\u0430\u044e\u0449\u0435\u0435 \u0418\u041b\u0418-\u041d\u0415","or":"\u0418\u041b\u0418","outcontact":"\u0412\u044b\u0445\u043e\u0434\u043d\u043e\u0439 \u043a\u043e\u043d\u0442\u0430\u043a\u0442","xor":"\u0418\u0441\u043a\u043b\u044e\u0447\u0430\u044e\u0449\u0435\u0435 \u0418\u041b\u0418"},"error":"\u041e\u0448\u0438\u0431\u043a\u0430","gdrive":{"error":{"code":"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043a\u043e\u0434","file-loading":"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0444\u0430\u0439\u043b\u0430","file-save":"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 Google Drive","login":"\u041e\u0448\u0438\u0431\u043a\u0430 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438","logout":"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u044b\u0445\u043e\u0434\u0430","unknown":"\u0421\u043b\u0443\u0436\u0431\u0430 Google Drive \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430"},"fs":{"empty":"\u0422\u0435\u043a\u0443\u0449\u0430\u044f \u043f\u0430\u043f\u043a\u0430 \u043f\u0443\u0441\u0442\u0430","login-message":"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0432 Google \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u0434\u0438\u0441\u043a\u0443","success-save":"\u0424\u0430\u0439\u043b \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d \u043d\u0430 Google Drive","upper":"\u041d\u0430 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0432\u044b\u0448\u0435","warning":"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0443\u0439\u0442\u0435\u0441\u044c \u0432 Google"},"login":"\u0412\u043e\u0439\u0442\u0438","logout":"\u0412\u044b\u0439\u0442\u0438","manage":"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u043e\u043c","paste":"\u0412\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043a\u043e\u0434 \u0432 \u043e\u043a\u043d\u043e:","submit":"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c","success":{"login":"\u0423\u0441\u043f\u0435\u0448\u043d\u044b\u0439 \u0432\u0445\u043e\u0434 \u0432 Google Account","logout":"\u0423\u0441\u043f\u0435\u0448\u043d\u044b\u0439 \u0432\u044b\u0445\u043e\u0434"},"title":"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u043e\u043c Google"},"groups":{"base":"\u0411\u0430\u0437\u043e\u0432\u044b\u0435","gates":"\u0428\u043b\u044e\u0437\u044b","io":"\u0412\u0432\u043e\u0434/\u0432\u044b\u0432\u043e\u0434"},"loading":"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430","loading-file":"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 {{file}}","notice":"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435","props":{"color":"\u0426\u0432\u0435\u0442","current-value":"\u0422\u0435\u043a\u0443\u0449\u0435\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435","in":"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043e\u0432","initial-value":"\u041d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435","invert":"\u0418\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"},"select-language":"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u044f\u0437\u044b\u043a","warning":"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!"}')},47:function(e,t,n){e.exports=n(76)},52:function(e,t,n){},63:function(e,t,n){e.exports=n.p+"static/media/or.d1e550b4.svg"},64:function(e,t,n){e.exports=n.p+"static/media/and.3082a1bb.svg"},65:function(e,t,n){e.exports=n.p+"static/media/nor.b0df7711.svg"},66:function(e,t,n){e.exports=n.p+"static/media/nand.90156a5e.svg"},67:function(e,t,n){e.exports=n.p+"static/media/xor.24ce4487.svg"},68:function(e,t,n){e.exports=n.p+"static/media/nxor.a94b65d4.svg"},69:function(e,t,n){e.exports=n.p+"static/media/const.ff0935a2.svg"},70:function(e,t,n){e.exports=n.p+"static/media/button.7c4fae13.svg"},71:function(e,t,n){e.exports=n.p+"static/media/invertor.590f4c64.svg"},72:function(e,t,n){e.exports=n.p+"static/media/buffer.ed9f6d1b.svg"},73:function(e,t,n){e.exports=n.p+"static/media/out-contact.f2004e70.svg"},76:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),s=n(35),r=n.n(s),o=(n(52),n(8)),l=n(43),c={en:{translation:n(39)},ru:{translation:n(40)}},u=navigator.language.match(/ru/gim)?"ru":"en";o.a.use(l.a).init({resources:c,lng:u,interpolation:{escapeValue:!1}});var h=o.a,p=n(4),d=n(5),m=n(2),f=n(3),v=n(7),g=n(6),b=n(26),y=n.n(b),E=n(30),O=n(1),k=n.n(O),C=["name","props","outContacts","className","x","y","id","width","height","signature","signatureSize","interactable","originY"],j=["invert","value"],S=["pin","type"],w={inContacts:["Buffer","Invertor","OutContact"],invert1:["Buffer","Invertor"]},N=n(44),x=n(79),T=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Object(p.a)(this,e),"Wire"===t.name||"Junction"===t.name)this.pins=new Array(1).fill(null).map(function(){return{coords:null,value:void 0,invert:!1,model:null,helper:null,helperEnabled:!0,wiredTo:null,valueUpdate:new x.a(void 0),observable:null}});else{var i=n?t.outContacts:t.props.inContacts,a=t.width,s=t.height,r=t.originY,o=0,l=s-2*r,c=Math.round(l/10),u=new Array(c),h=Math.round(c/2);t.maxContacts=c;for(var d=0;d<c;d++)u[d]=o,o+=12;for(var m=[],f=0;f<Math.floor(i/2);f++){for(var v=u[c-1]+1,g=0,b=0;b<c;b++)u[b]<v&&m.indexOf(u[b])<0&&(v=u[b]),u[b]>g&&m.indexOf(u[b])<0&&(g=u[b]);m.push(v,g)}i%2!==0&&m.push(u[h-1]);var y=m.sort().map(function(e){return e++,n?{x1:a,y1:e,x2:a+12,y2:e}:{x1:-12,y1:e,x2:0,y2:e}}),E=n?"outPins":"inPins";this.pins=new Array(i).fill(null).map(function(e,n){return{coords:y[n],value:k.a.get(t,"".concat(E,".pins.[").concat(n,"].value"),void 0),model:null,helper:null,helperEnabled:!0,wiredTo:k.a.get(t,"".concat(E,".pins.[").concat(n,"].wiredTo"),null),invert:k.a.get(t,"".concat(E,".pins.[").concat(n,"].invert"),!1),valueUpdate:new x.a(void 0),observable:null}})}}return Object(d.a)(e,[{key:"disablePinHelper",value:function(e){this.pins[e].helper&&(this.pins[e].helper.opacity=0,this.pins[e].helperEnabled=!1)}},{key:"enablePinHelper",value:function(e){this.pins[e].helper&&(this.pins[e].helper.opacity=0,this.pins[e].helperEnabled=!0)}}]),e}(),_="vertical",P="horizontal",D="T2B",I="B2T",W="L2R",A="R2L",G=function(){function e(t){Object(p.a)(this,e),this.id=t.id,this.name=t.name,this.outContacts=t.outContacts,this.width=t.width,this.height=t.height,this.signature=t.signature||"",this.className="element-".concat(t.name," element"),this.originY=t.originY||0,this.interactable=t.interactable||"Button"===t.name,this.signatureSize=t.signatureSize||24,this.setProps(t.props),this.model=null,this.active=!1,this.subscriptions=null,this.signatureModel=null,this.helpers=null,this.renderFlag=new x.a(null),this.x=null,this.y=null,this.modelGroup=null,this.pinToggleObservable=new N.a,this.interactionModel=null}return Object(d.a)(e,null,[{key:"setIdCounter",value:function(t){e.elementCounter=t}}]),Object(d.a)(e,[{key:"setProps",value:function(e){this.props=e,this.props.inContacts&&(this.inPins=new T(this)),this.outContacts&&(this.outPins=new T(this,!0))}},{key:"setInPinInvertState",value:function(e,t){this.inPins&&(this.inPins.pins[e].invert=t)}},{key:"setId",value:function(){this.id||(this.id=this.name+e.elementCounter,e.elementCounter++),this.model&&this.model.classList.push(this.id),this.modelGroup&&this.modelGroup.classList.push(this.id)}},{key:"getCoords",value:function(){if(this.model)return{x1:this.x,y1:this.y,orientation:P,direction:D}}},{key:"operation",value:function(){}},{key:"errorCheck",value:function(){var e=k.a.get(this.inPins,"pins",null),t=k.a.get(this.outPins,"pins",null);e&&(k.a.countBy(e,"value").overload&&k.a.map(t,function(e){return k.a.set(e,"value","overload")}),(k.a.countBy(e,"value")[void 0]===e.length||k.a.countBy(e,"value").null)&&k.a.map(t,function(e){return k.a.set(e,"value",null)}))}},{key:"getStateColor",value:function(e){var t;switch(e){case 0:t="#006200";break;case 1:t="#00FF00";break;case"overload":t="#ff7700";break;case void 0:t="#0077ff";break;default:t="#FF0000"}return t}},{key:"disableInPinHelper",value:function(e){this.inPins.disablePinHelper(e),this.pinToggleObservable.next(this.inPins.pins[e]),this.renderFlag.next()}},{key:"disableOutPinHelper",value:function(e){this.outPins.disablePinHelper(e),this.pinToggleObservable.next(this.outPins.pins[e]),this.renderFlag.next()}},{key:"enableInPinHelper",value:function(e){this.inPins.enablePinHelper(e),this.pinToggleObservable.next(this.outPins.pins[e]),this.renderFlag.next()}},{key:"enableOutPinHelper",value:function(e){this.outPins.enablePinHelper(e),this.pinToggleObservable.next(this.outPins.pins[e]),this.renderFlag.next()}},{key:"addSubscription",value:function(){var e=this;k.a.forEach(arguments,function(t){!e.subscriptions||k.a.get(e.subscriptions,"closed",!1)?e.subscriptions=t:e.subscriptions.add(t)})}},{key:"destroy",value:function(){this.outPins&&k.a.forEach(this.outPins.pins,function(e){var t=e.wiredTo;if(e.helperEnabled=!0,t){var n=t.inPins.pins[0];console.log(t),t.inSub.unsubscribe(),t.enableInPinHelper(0),n.wiredTo=null,t.inConnector=null,n.value=void 0,t.updateState(),e.wiredTo=null}}),this.inPins&&k.a.forEach(this.inPins.pins,function(e){var t=e.wiredTo;if(e.helperEnabled=!0,t){var n=t.outPins.pins[0];t.outSub.unsubscribe(),n.wiredTo=null,t.outConnector=null,t.enableOutPinHelper(0),e.wiredTo=null,t.updateState()}}),this.subscriptions.unsubscribe()}},{key:"updateState",value:function(){var e=this,t=Boolean(this.props.inContacts),n=Boolean(this.outContacts);t&&this.inPins.pins.forEach(function(t,n){t.value=k.a.get(t,"wiredTo.outPins.pins[0].value",void 0),e.model.children[1].children[n].stroke=e.getStateColor(t.value),t.invert&&!isNaN(t.value)&&null!==t.value&&(t.value=Number(!t.value))}),this.operation(),this.errorCheck(),n&&this.outPins.pins.forEach(function(t,n){e.model.children[2].children[n].stroke=e.getStateColor(t.value),t.valueUpdate.next(t.value)}),this.renderFlag.next()}}]),e}();G.elementCounter=0;var L=G,R={name:"Or",props:{inContacts:3,fill:"#ffffff"},outContacts:1,originY:5,width:50,height:60,signature:"1"},B=function(e){function t(e){var n;return Object(p.a)(this,t),n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,R)),Object(m.a)(n)}return Object(g.a)(t,e),Object(d.a)(t,[{key:"operation",value:function(){this.outPins.pins[0].value=Number(k.a.reduce(this.inPins.pins,function(e,t){return Boolean(e||t.value)},0))}}]),t}(L),M=n(13),F={name:"Nor",props:{inContacts:3,fill:"#ffffff"},originY:5,outContacts:1,width:50,height:60,signature:"1"},H=function(e){function t(e){var n;return Object(p.a)(this,t),n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,F)),Object(m.a)(n)}return Object(g.a)(t,e),Object(d.a)(t,[{key:"setProps",value:function(e){Object(M.a)(Object(f.a)(t.prototype),"setProps",this).call(this,e),this.outPins.pins[0].invert=!0}},{key:"operation",value:function(){this.outPins.pins[0].value=Number(!k.a.reduce(this.inPins.pins,function(e,t){return Boolean(e||t.value)},0))}}]),t}(L),U={name:"And",props:{inContacts:3,fill:"#ffffff"},outContacts:1,originY:5,width:50,height:60,signature:"&"},V=function(e){function t(e){var n;return Object(p.a)(this,t),n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,U)),Object(m.a)(n)}return Object(g.a)(t,e),Object(d.a)(t,[{key:"operation",value:function(){this.outPins.pins[0].value=Number(k.a.reduce(this.inPins.pins,function(e,t){return Boolean(e&&t.value)},1))}}]),t}(L),J={name:"Nand",props:{inContacts:3,fill:"#ffffff"},originY:5,width:50,outContacts:1,height:60,signature:"&"},z=function(e){function t(e){var n;return Object(p.a)(this,t),n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,J)),Object(m.a)(n)}return Object(g.a)(t,e),Object(d.a)(t,[{key:"setProps",value:function(e){Object(M.a)(Object(f.a)(t.prototype),"setProps",this).call(this,e),this.outPins.pins[0].invert=!0}},{key:"operation",value:function(){this.outPins.pins[0].value=Number(!k.a.reduce(this.inPins.pins,function(e,t){return Boolean(e&&t.value)},1))}}]),t}(L),Y={name:"Xor",props:{inContacts:3,fill:"#ffffff"},outContacts:1,originY:5,width:50,height:60,signature:"=1"},Z=function(e){function t(e){var n;return Object(p.a)(this,t),n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,Y)),Object(m.a)(n)}return Object(g.a)(t,e),Object(d.a)(t,[{key:"operation",value:function(){this.outPins.pins[0].value=1===k.a.countBy(this.inPins.pins,"value")[1]?1:0}}]),t}(L),X={name:"Nxor",props:{inContacts:3,fill:"#ffffff"},outContacts:1,originY:5,width:50,height:60,signature:"=1"},q=function(e){function t(e){var n;return Object(p.a)(this,t),n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,X)),Object(m.a)(n)}return Object(g.a)(t,e),Object(d.a)(t,[{key:"setProps",value:function(e){Object(M.a)(Object(f.a)(t.prototype),"setProps",this).call(this,e),this.outPins.pins[0].invert=!0}},{key:"operation",value:function(){this.outPins.pins[0].value=Number(!(1===k.a.countBy(this.inPins.pins,"value")[1]))}}]),t}(L),$={name:"Constant",props:{signal:0,fill:"#ffffff"},outContacts:1,originY:0,width:26,height:26,signature:"0",signatureSize:20},K=function(e){function t(e){var n;return Object(p.a)(this,t),n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,$)),Object(m.a)(n)}return Object(g.a)(t,e),Object(d.a)(t,[{key:"setProps",value:function(e){Object(M.a)(Object(f.a)(t.prototype),"setProps",this).call(this,e),this.signature=String(e.signal)}},{key:"operation",value:function(){var e=this.getStateColor(this.props.signal);this.outPins.pins[0].value=Number(this.props.signal),this.signatureModel.stroke=e,this.signatureModel.fill=e,this.model._children[0].stroke=e}}]),t}(L),Q={EDIT:"edit",WIRE:"wire",CREATE:"create",INTERACT:"interact",LOAD_DATA:"load",DISABLE_MODELING:"modeling-disabled"},ee=n(80),te={name:"Button",props:{initialSignal:0,fill:"#fff6fc"},outContacts:1,interactable:!0,originY:0,width:26,height:26,signature:"0",signatureSize:20},ne=function(e){function t(e){var n;return Object(p.a)(this,t),n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,te)),Object(m.a)(n)}return Object(g.a)(t,e),Object(d.a)(t,[{key:"setInteractions",value:function(){var e=this,n=this.interactionModel._renderer.elem,i=Object(ee.a)(n,"click").subscribe(function(){L.boardState===Q.INTERACT&&(e.props.initialSignal=Number(!e.props.initialSignal),Object(M.a)(Object(f.a)(t.prototype),"updateState",e).call(e))});this.addSubscription(i)}},{key:"updateState",value:function(){Object(M.a)(Object(f.a)(t.prototype),"updateState",this).call(this),this.setInteractions(),this.updateState=Object(M.a)(Object(f.a)(t.prototype),"updateState",this)}},{key:"operation",value:function(){var e=this.props.initialSignal;this.outPins.pins[0].value=e,this.signatureModel.stroke=this.getStateColor(e),this.signatureModel.fill=this.getStateColor(e),this.signatureModel.value=String(e)}}]),t}(L),ie={name:"Junction",props:{fill:"#000000"}},ae=function(e){function t(e){var n;return Object(p.a)(this,t),(n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,ie))).inConnector=[],n.outConnector=[],n.model=null,n.outPins=new T(Object(v.a)(n)),n.inPins=new T(Object(v.a)(n)),n.junctionHelpers=[],n.inWires=[],n.outWires=[],n.errorRegistred=!1,Object(m.a)(n)}return Object(g.a)(t,e),Object(d.a)(t,[{key:"getTotalWired",value:function(){return k.a.union(this.inWires,this.outWires).length}},{key:"pushWire",value:function(e){var t=e.getCurrentSignalSource();t&&t.el.id!==this.id?(this.inWires.push(e),e.outConnector={el:this,pin:0,type:"in"}):(this.outWires.push(e),e.inConnector={el:this,pin:0,type:"out"})}},{key:"removeWire",value:function(e){k.a.find(this.inWires,e)&&k.a.remove(this.inWires,function(t){return t.id===e.id}),k.a.find(this.outWires,e)&&k.a.remove(this.outWires,function(t){return t.id===e.id})}},{key:"setErrorState",value:function(){var e=this;k.a.forEach(this.inWires,function(t){var n=t.getCurrentSignalSource();if(n&&e.model){var i=n.el,a=n.pin,s=k.a.get(i,"outPins.pins[".concat(a,"]"),null);"Junction"===i.name?(i.model.stroke=e.getStateColor(null),i.model.fill=e.getStateColor(null),i.setErrorState()):"Wire"!==i.name&&(i.model.children[2].children[a].stroke=e.getStateColor(null));for(var r=s.wiredTo;"Wire"===k.a.get(r,"name",null)&&r;r=r.outConnector.el)r.model.stroke=e.getStateColor(null)}})}},{key:"unsetErrorState",value:function(){var e=this;k.a.forEach(this.inWires,function(t){var n=t.getCurrentSignalSource();if(n&&e.model){var i=n.el,a=n.pin,s=k.a.get(i,"outPins.pins[".concat(a,"]"),null);"Junction"===i.name?(i.model.stroke=e.getStateColor(s.value),i.model.fill=e.getStateColor(s.value),i.unsetErrorState()):"Wire"!==i.name&&(i.model.children[2].children[a].stroke=e.getStateColor(s.value));for(var r=s.wiredTo;"Wire"===k.a.get(r,"name",null);r=r.outConnector.el)r.model.stroke=e.getStateColor(s.value)}})}},{key:"operation",value:function(){var e=k.a.get(this.inWires[0],"outPins.pins[0].value",void 0),t=!1,n=e;k.a.forEach(this.inWires,function(n){k.a.get(n,"outPins.pins[0].value")!==e&&(t=!0)}),t&&(n=null,this.errorRegistred=!0,this.setErrorState()),this.outPins.pins[0].value=n,this.model&&k.a.forEach(this.outWires,function(e){for(var t=e,i=t;i.outConnector&&"Wire"===k.a.get(i,"outConnector.el.name",null);i=i.outConnector.el)t=i.outConnector.el;k.a.set(t,"outPins.pins[0].value",n)}),this.outPins.pins[0].valueUpdate.next(n),this.model&&(this.model.fill=this.getStateColor(n),this.model.stroke=this.getStateColor(n))}},{key:"destroy",value:function(){if(1===this.inWires.length&&1===this.outWires.length){var e=this.inWires[0],t=this.outWires[0];e.unsub(),t.unsub(),e.outConnector={el:t,pin:0,type:"in"},t.inConnector={el:e,pin:0,type:"out"},e.wire(),t.wire(),this.inWires=[],this.outWires=[],this.model.remove()}this.subscriptions.unsubscribe()}},{key:"updateState",value:function(){this.errorRegistred&&(this.errorRegistred=!1,this.unsetErrorState()),this.operation(),this.renderFlag.next()}}]),t}(L),se={name:"Invertor",props:{inContacts:1,fill:"#ffffff"},originY:5,outContacts:1,width:38,height:38,signature:"1"},re=function(e){function t(e){var n;return Object(p.a)(this,t),n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,se)),Object(m.a)(n)}return Object(g.a)(t,e),t}(H),oe={name:"Buffer",props:{inContacts:1,fill:"#ffffff"},originY:5,outContacts:1,width:38,height:38,signature:"1"},le=function(e){function t(e){var n;return Object(p.a)(this,t),n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,oe)),Object(m.a)(n)}return Object(g.a)(t,e),t}(B),ce={name:"OutContact",props:{fill:"#fff6fc",inContacts:1},interactable:!1,outContacts:0,originY:0,width:26,height:26,signature:"0",signatureSize:20},ue=function(e){function t(e){var n;return Object(p.a)(this,t),n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,ce)),Object(m.a)(n)}return Object(g.a)(t,e),Object(d.a)(t,[{key:"operation",value:function(){var e=this.inPins.pins[0].value;this.signatureModel.stroke=this.getStateColor(e),this.signatureModel.fill=this.getStateColor(e),this.signatureModel.value=0===e||e?String(e):"x"}}]),t}(L),he=function(){function e(){Object(p.a)(this,e)}return Object(d.a)(e,null,[{key:"getCreateFuncByName",value:function(t){return e.elementMap.get(t).create}},{key:"getIconByName",value:function(t){return e.elementMap.get(t).icon}}]),e}();he.elementMap=new Map([["Or",{create:function(e){return new B(e)},icon:n(63)}],["And",{create:function(e){return new V(e)},icon:n(64)}],["Nor",{create:function(e){return new H(e)},icon:n(65)}],["Nand",{create:function(e){return new z(e)},icon:n(66)}],["Xor",{create:function(e){return new Z(e)},icon:n(67)}],["Nxor",{create:function(e){return new q(e)},icon:n(68)}],["Constant",{create:function(e){return new K(e)},icon:n(69)}],["Button",{create:function(e){return new ne(e)},icon:n(70)}],["Junction",{create:function(e){return new ae(e)},icon:null}],["Invertor",{create:function(e){return new re(e)},icon:n(71)}],["Buffer",{create:function(e){return new le(e)},icon:n(72)}],["OutContact",{create:function(e){return new ue(e)},icon:n(73)}]]);var pe=he,de=n(45),me=n(81),fe={name:"Wire",props:{fill:"#000000"}},ve=function(e){function t(e){var n;return Object(p.a)(this,t),(n=e?Object(m.a)(this,Object(f.a)(t).call(this,e)):Object(m.a)(this,Object(f.a)(t).call(this,fe))).inConnector=null,n.outConnector=null,n.model=null,n.outPins=new T(Object(v.a)(n)),n.inPins=new T(Object(v.a)(n)),n.junctionHelpers=[],n.inSub=null,n.outSub=null,Object(m.a)(n)}return Object(g.a)(t,e),Object(d.a)(t,[{key:"updateState",value:function(){var e=k.a.get(this.inConnector,"el"),t=k.a.get(this.inConnector,"pin"),n=k.a.get(e,"outPins.pins[".concat(t,"].value"),void 0);this.inPins.pins[0].value=n,this.outPins.pins[0].value=n,this.model.stroke=this.getStateColor(n);try{this.outPins.pins[0].valueUpdate.next(n)}catch(l){var i=this.getCurrentSignalSource().el,a=this.getCurrentSignalSource().pin,s=this.getCurrentSignalGoal().el,r=this.getCurrentSignalGoal().pin;i.model.children[2].children[a].stroke=this.getStateColor("overload"),s.model.children[1].children[r].stroke=this.getStateColor("overload"),s.inPins.pins[r].value="overload",i.outPins.pins[a].value="overload";for(var o=i.outPins.pins[a].wiredTo;"Wire"===o.name;o=o.outConnector.el)o.model.stroke=this.getStateColor("overload"),o.outPins.pins[0].value="overload"}this.renderFlag.next()}},{key:"unsub",value:function(){var e=this.inConnector,t=this.outConnector;if(t&&this.outSub){var n=t.el;this.outPins.pins[0].value=void 0,n.updateState(),this.outSub.unsubscribe(),n.enableInPinHelper(t.pin),"Junction"===n.name&&(n.removeWire(this),2===n.getTotalWired()&&n.destroy())}if(e&&this.inSub){var i=e.el;this.inSub.unsubscribe(),i.enableOutPinHelper(e.pin),"Junction"===i.name&&(i.removeWire(this),2===i.getTotalWired()&&i.destroy())}}},{key:"destroy",value:function(){this.unsub(),this.subscriptions.unsubscribe()}},{key:"getCoords",value:function(){if(this.model){var e,t,n=k.a.get(this.model,"vertices",null),i={x1:n[0].x,y1:n[0].y,x2:n[1].x,y2:n[1].y};return i.x1===i.x2?(e=_,t=i.y1>i.y2?D:I):i.y1===i.y2&&(e=P,t=i.x1>i.x2?W:A),Object(de.a)({},i,{orientation:e,direction:t})}}},{key:"getCurrentSignalGoal",value:function(){for(var e,t=this;"Wire"===t.name&&t.outConnector;t=t.outConnector.el)e=t.outConnector;return k.a.get(e,"el.name",null)?e:null}},{key:"getCurrentSignalSource",value:function(){for(var e,t=this;"Wire"===t.name&&t.inConnector;t=t.inConnector.el)e=t.inConnector;return"Wire"!==k.a.get(e,"el.name",null)?e:null}},{key:"wire",value:function(){var e=this,t=this.inConnector,n=this.outConnector;if(n){var i=n.el,a=n.pin;i.disableInPinHelper(a),this.disableOutPinHelper(0),i.inPins.pins[a].wiredTo=this,"Wire"===i.name&&(i.inConnector={el:this,pin:0,type:"out"}),this.outSub=this.outPins.pins[0].valueUpdate.pipe(Object(me.a)()).subscribe(function(){i.updateState()})}if(t){var s=t.el,r=t.pin;this.disableInPinHelper(0),"Junction"!==s.name?s.disableOutPinHelper(r):4===s.getTotalWired()&&s.disableOutPinHelper(r),s.outPins.pins[r].wiredTo=this,"Wire"===s.name&&(s.outConnector={el:this,pin:0,type:"in"}),this.inSub=s.outPins.pins[r].valueUpdate.pipe(Object(me.a)()).subscribe(function(){e.updateState()})}else this.updateState();this.id||(this.setId(),k.a.forEach(this.junctionHelpers,function(t){t.classList.push(e.id)}),k.a.forEach(this.inPins.pins,function(t){t.helper.classList.push(e.id)}),k.a.forEach(this.outPins.pins,function(t){t.helper.classList.push(e.id)}))}},{key:"getElement",value:function(){return k.a.get(this.model,"_renderer.elem",null)}}]),t}(L),ge=n(17),be=n(41),ye=function(){function e(){Object(p.a)(this,e)}return Object(d.a)(e,null,[{key:"createEvent",value:function(e){this.subsBuffer[e]=new N.a}},{key:"publish",value:function(e,t){this.subsBuffer[e].next(t)}},{key:"subscribe",value:function(e,t){this.subsBuffer[e].subscribe(t)}},{key:"unsubscribe",value:function(e){this.subsBuffer[e].unsubscribe(),this.createEvent(e)}}]),e}();ye.subsBuffer={};var Ee=ye,Oe={SET_BOARD_STATE:"SET_BOARD_STATE",BOARD_RESIZE:"BOARD_RESIZE",UPDATE_DATA:"UPDATE_DATA",TOGGLE_LOADING:"TOGGLE_LOADING",SHOW_NOTICE:"SHOW_NOTICE",TOGGLE_GDRIVE_POPUP:"TOGGLE_GDRIVE_POPUP",TOGGLE_FILE_BROWSER:"TOGGLE_FILE_BROWSER",SET_CURRENT_ELEMENT:"SET_CURRENT_ELEMENT",MODELING_OFF:"MODELING_OFF"},ke=function(){function e(){Object(p.a)(this,e)}return Object(d.a)(e,null,[{key:"init",value:function(e){var t=this;this.board=e;var n=this.board.parentElement.getBoundingClientRect(),i=n.width,a=n.height;this.svg=new be.a({width:i,height:a}).appendTo(this.board),this.render=this.render.bind(this),this.background=this.svg.makeGroup(),this.middleground=this.svg.makeGroup(),this.foreground=this.svg.makeGroup(),Ee.subscribe(Oe.BOARD_RESIZE,function(e){var n=e.width,i=e.height;t.setFieldSize(n,i)})}},{key:"getFieldData",value:function(){var e=this.board.getBoundingClientRect();return{width:e.width,height:e.height}}},{key:"setFieldSize",value:function(e,t){this.svg.width=e,this.svg.height=t,this.board.style.width="".concat(e,"px"),this.board.style.height="".concat(t,"px"),this.render()}},{key:"renderWire",value:function(e,t,n,i,a){var s=this,r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=this.svg.makeLine(t,n,i,a);if(o.fill=e.fill||"#000000",o.opacity=1,o.linewidth=2,e.className&&o.classList.push(e.className),e.model=o,e.name&&(e.renderFlag.subscribe(function(){s.render()}),e.pinToggleObservable.subscribe(function(e){e.helperEnabled?s.foreground.add(e.helper):s.background.add(e.helper)})),"Wire"===e.className){var l=e.inConnector?[t,n]:[i,a],c=Object(ge.a)(l,2),u=c[0],h=c[1],p=e.inConnector?[i,a]:[t,n],d=Object(ge.a)(p,2),m=d[0],f=d[1],v=this.renderHelpCircle(u,h),g=this.renderHelpCircle(m,f),b=[];if(this.foreground.add(v),this.foreground.add(g),t===i)if(n<a)for(var y=n+13;y<a-12;y+=12)b.push(this.renderHelpCircle(t,y));else for(var E=n-13;E>a+12;E-=12)b.push(this.renderHelpCircle(t,E));else if(t<i)for(var O=t+13;O<i-12;O+=12)b.push(this.renderHelpCircle(O,n));else for(var C=t-13;C>i+12;C-=12)b.push(this.renderHelpCircle(C,n));k.a.forEach(b,function(t){e.junctionHelpers.push(t),s.foreground.add(t)});var j=this.svg.makeGroup(b);e.modelGroup=this.svg.makeGroup(o,j,v,g),e.inPins.pins[0].helper=v,e.outPins.pins[0].helper=g}return this.background.add(o),r&&this.render(),o}},{key:"makeElement",value:function(e,t,n){var i=e.props,a=i.className||e.className,s=n+e.height/2-e.originY,r=t+e.width/2,o=null;return(o="OutContact"===e.name?this.svg.makeCircle(r,s,e.width/2):this.svg.makeRectangle(r,s,e.width,e.height)).fill=i.fill,o.opacity=i.opacity||1,e.x=r,e.y=s,a&&o.classList.push(a),o}},{key:"renderGhost",value:function(e,t,n){return this.makeElement(e,t,n).className="ghost",this.render()}},{key:"renderHelpCircle",value:function(e,t){var n=this.svg.makeCircle(e,t,5);return n.fill="#00000000",n.stroke="#14ff53",n.opacity=0,n.className="help-circle",n}},{key:"renderInvertCircle",value:function(e,t){var n=this.svg.makeCircle(e,t,3.5);return n.fill="#ffffff",n.stroke="#000000",n.classList.push("invert-circle"),n.className="invert-circle",n.linewidth=1,n}},{key:"renderJunction",value:function(e,t,n){var i=this,a=this.svg.makeCircle(t,n,3),s=this.renderHelpCircle(t,n);return a.className="junction-circle",a.fill="#000000",this.background.add(a),e.model=a,e.x=t,e.y=n,e.outPins.pins[0].helper=s,e.renderFlag.subscribe(function(){i.render()}),e.pinToggleObservable.subscribe(function(e){e.helperEnabled?i.foreground.add(e.helper):i.background.add(e.helper)}),this.foreground.add(s),a}},{key:"renderText",value:function(e,t,n,i){return this.svg.makeText(e,t,n,i)}},{key:"renderActiveWireZone",value:function(e){var t=e.getCoords(),n=t.x1,i=t.y1,a=t.x2,s=t.y2,r=t.orientation,o=t.direction,l=0,c=0;r===P&&(l=o===W?3:-3),r===_&&(c=o===D?3:-3);var u=this.svg.makeRectangle(n-l,i-c,7,7),h=this.svg.makeRectangle(a+l,s+c,7,7);this.svg.makeGroup(u,h).classList.push("active-zone"),this.render()}},{key:"renderActiveZone",value:function(e){if(e.width&&e.height){var t=e.width,n=e.height,i=e.x-e.width/2,a=e.y+e.height/2,s=i,r=a,o=i+t,l=a,c=i,u=a-n,h=i+t,p=a-n,d=this.svg.makeRectangle(s-3,r+3,7,7),m=this.svg.makeRectangle(o+3,l+3,7,7),f=this.svg.makeRectangle(c-3,u-3,7,7),v=this.svg.makeRectangle(h+3,p-3,7,7);this.svg.makeGroup(d,m,f,v).classList.push("active-zone"),this.render()}}},{key:"eraseActiveZone",value:function(){this.removeElementById("active-zone")}},{key:"renderElement",value:function(e,t,n){var i=this,a=this.makeElement(e,t,n),s=[],r=[],o=[],l=[],c=[],u=[],h=[];if(e.inPins&&e.inPins.pins.forEach(function(e){var a=[t+e.coords.x1,n+e.coords.y1,t+e.coords.x2,n+e.coords.y2],r=a[0],o=a[1],u=a[2],h=a[3];s.push(i.renderWire({},r,o,u,h)),e.invert&&c.push(i.renderInvertCircle(u,h)),l.push(i.renderHelpCircle(r,o))}),e.outPins&&e.outPins.pins.forEach(function(e){var a=[t+e.coords.x1,n+e.coords.y1,t+e.coords.x2,n+e.coords.y2],s=a[0],l=a[1],c=a[2],h=a[3];r.push(i.renderWire({},s,l,c,h)),e.invert&&u.push(i.renderInvertCircle(s,l)),o.push(i.renderHelpCircle(c,h))}),e.signature){var p=this.renderText(e.signature,t+e.width/2,n+15);p.size=e.signatureSize,e.signatureModel=p,h.push(p)}var d=this.svg.makeGroup(a),m=this.svg.makeGroup(s),f=this.svg.makeGroup(r),v=this.svg.makeGroup(l),g=this.svg.makeGroup(o),b=this.svg.makeGroup(c),y=this.svg.makeGroup(u),E=this.svg.makeGroup(h),O=this.svg.makeGroup(d,m,f,v,g,b,y,E);if(e.id&&(a.classList.push(e.id),O.classList.push(e.id)),O.className=e.className,e.interactable){var C=this.svg.makeGroup(a,E);C.className=e.className,O.add(C),e.interactionModel=C}e.model=O,k.a.forEach(s,function(t,n){e.inPins.pins[n].model=t,e.inPins.pins[n].helper=l[n]}),k.a.forEach(r,function(t,n){e.outPins.pins[n].model=t,e.outPins.pins[n].helper=o[n]}),e.renderFlag.subscribe(function(){i.render()}),this.foreground.add(O)}},{key:"getElement",value:function(e){return this.svg.scene.getByClassName(e.props.className||e.className)}},{key:"removeElementById",value:function(e){var t=this.svg.scene.getByClassName(e);return k.a.forEach(t,function(e){e.remove()}),this.render()}},{key:"removeElement",value:function(e){var t=this.svg.scene.getByClassName(k.a.get(e,"props.className",!1)||e.className);k.a.forEach(t,function(e){e.remove()})}},{key:"clearScene",value:function(){this.svg.clear(),this.render(),this.background=this.svg.makeGroup(),this.middleground=this.svg.makeGroup(),this.foreground=this.svg.makeGroup()}},{key:"render",value:function(){this.svg.update()}}]),e}(),Ce=n(42),je=n.n(Ce),Se=function(){function e(){Object(p.a)(this,e)}return Object(d.a)(e,null,[{key:"makeFile",value:function(e){var t=e.schemeName,n=ke.getFieldData(),i=n.width,a=n.height,s=k.a.map(e.elements,function(e){var t=null,n=null;return e.inPins&&(t=k.a.map(e.inPins.pins,function(e){return k.a.pick(e,j)})),e.outPins&&(n=k.a.map(e.outPins.pins,function(e){return k.a.pick(e,j)})),k.a.chain(e).pick(C).extend({inPins:t,outPins:n}).value()}),r=k.a.map(e.wires,function(e){var t=null,n=null,i=null,a=null,s=e.getCoords();return e.inPins&&(t=k.a.map(e.inPins.pins,function(e){return k.a.pick(e,j)})),e.outPins&&(n=k.a.map(e.outPins.pins,function(e){return k.a.pick(e,j)})),e.inConnector&&(i=k.a.chain(e.inConnector).pick(S).extend({el:k.a.get(e.inConnector,"el.id","")}).value()),e.outConnector&&(a=k.a.chain(e.outConnector).pick(S).extend({el:k.a.get(e.outConnector,"el.id","")}).value()),k.a.chain(e).pick(C).extend({inPins:t,outPins:n,inConnector:i,outConnector:a,coords:s}).value()});return JSON.stringify({schemeName:t,width:i,height:a,elements:s,wires:r},null,"\t")}},{key:"saveFile",value:function(e){var t=e.schemeName,n=this.makeFile(e),i=document.createElement("a");i.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(n)),i.setAttribute("download",t+".dcb"),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}},{key:"saveAsPNG",value:function(e){var t=document.querySelectorAll("#board svg")[0];Ee.publish(Oe.TOGGLE_LOADING,{toggle:!0}),Ee.publish(Oe.SET_BOARD_STATE,Q.DISABLE_MODELING),Ee.subscribe(Oe.MODELING_OFF,function(){je()(t,{logging:!1}).then(function(t){var n=document.createElement("a");n.download="".concat(e,".png"),n.href=t.toDataURL(),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),Ee.publish(Oe.SET_BOARD_STATE,Q.EDIT),Ee.publish(Oe.TOGGLE_LOADING,{toggle:!1}),Ee.unsubscribe(Oe.MODELING_OFF)})})}},{key:"saveAsSVG",value:function(e){var t=document.getElementById("board").innerHTML.replace(/stroke=".+?"/gim,'stroke="#000000"').replace(/(<svg.*?>)/gim,"$1".concat("<style>.junction-circle {fill: #000000} .ghost {display: none} text {fill: #000000}</style>")),n=document.createElement("a");n.setAttribute("href","data:image/svg+xml;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e+".svg"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},{key:"openFile",value:function(){document.getElementById("file-input").click()}},{key:"loadData",value:function(){var e=Object(E.a)(y.a.mark(function e(t,n){var i,a,s,r,o,l,c;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=/(.+)\.dcb/.exec(n)[1],a=[],s=t.width||2e3,r=t.height||2e3,ke.clearScene(),ke.setFieldSize(s,r),k.a.forEach(t.elements,function(e){var t=pe.getCreateFuncByName(e.name)(e);"Junction"===e.name?ke.renderJunction(t,e.x,e.y):(e.y-=t.height/2-t.originY,e.x-=t.width/2,ke.renderElement(t,e.x,e.y)),a.push(t),t.setId(),t.updateState()}),o=k.a.map(t.wires,function(e){return new ve(e)}),l=function(e){return k.a.find(k.a.union(o,a),{id:e})},k.a.forEach(o,function(e,n){var s=t.wires[n],r=s.coords,c=s.inConnector,u=s.outConnector,h=k.a.get(c,"el",null),p=k.a.get(u,"el",null);return h&&(c.el=l(h),e.inConnector=c,"Junction"===c.el.name&&c.el.pushWire(e)),p&&(u.el=l(p),e.outConnector=u,"Junction"===u.el.name&&u.el.pushWire(e)),e.className=e.name,ke.renderWire(e,r.x1,r.y1,r.x2,r.y2,!1),{schemeName:i,elements:a,wires:o}}),k.a.forEach(o,function(e){e.wire()}),c=k.a.chain(o).union(a).map(function(e){return Number(/\d+/.exec(e.id)[0])}).reduce(function(e,t){return k.a.max([e,t])},-1).value(),L.setIdCounter(c),e.abrupt("return",{schemeName:i,elements:a,wires:o});case 14:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadFile",value:function(e){var t=this,n=new FileReader,i=new N.a;return n.readAsText(e),n.onload=function(){t.loadData(JSON.parse(String(n.result)),e.name).then(function(e){i.next(e)})},n.onerror=function(){console.log(n.error)},i}},{key:"newFile",value:function(){document.getElementById("file-input").value="",ke.clearScene()}}]),e}(),we=n(28),Ne=n.n(we),xe=n(83),Te=n(84),_e=n(82),Pe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;return Object(Te.a)({url:"http://localhost:3030/"+e,method:"POST",timeout:n,body:t})},De=function(){function e(){Object(p.a)(this,e)}return Object(d.a)(e,null,[{key:"checkSession",value:function(){var e=Ne.a.get("session_id");return e||(e=Object(xe.a)(),Ne.a.set("session_id",e,{path:"/",expires:7})),this.sessionId=e,this.authorize()}},{key:"sendCode",value:function(e){var t=this;return Pe("code",{code:e,sessionId:this.sessionId}).pipe(Object(_e.a)(function(e){t.isLoggedIn="success"===k.a.get(e,"response.status",!1),t.user=k.a.get(e,"response.user",null)}))}},{key:"listFiles",value:function(e){var t=this,n=this.sessionId;return Pe("files",{sessionId:n,folderId:e}).pipe(Object(_e.a)(function(e){t.isLoggedIn=!("auth"===k.a.get(e,"response.status",!1)),t.user=t.isLoggedIn?t.user:null}))}},{key:"getFile",value:function(e){var t=this,n=this.sessionId;return Pe("load",{sessionId:n,fileId:e},2e4).pipe(Object(_e.a)(function(e){t.isLoggedIn=!("auth"===k.a.get(e,"response.status",!1)),t.user=t.isLoggedIn?t.user:null}))}},{key:"saveFile",value:function(e,t){var n=this,i=this.sessionId,a=Se.makeFile(e);return Pe("save",{sessionId:i,schemeData:a,folderId:t},2e4).pipe(Object(_e.a)(function(e){n.isLoggedIn=!("auth"===k.a.get(e,"response.status",!1)),n.user=n.isLoggedIn?n.user:null}))}},{key:"logout",value:function(){var e=this,t=this.sessionId;return Pe("logout",{sessionId:t}).pipe(Object(_e.a)(function(t){e.isLoggedIn=!("success"===k.a.get(t,"response.status",!1)),e.user=e.isLoggedIn?e.user:null}))}},{key:"authorize",value:function(){var e=this,t=this.sessionId;return Pe("auth",{sessionId:t}).pipe(Object(_e.a)(function(t){e.isLoggedIn="success"===k.a.get(t,"response.status",!1),e.user=k.a.get(t,"response.user",null)}))}}]),e}();De.sessionId=null,De.isLoggedIn=!1,De.user=null;var Ie=De;var We=function(e){return a.a.createElement("div",{className:"spinner"})};var Ae=function(e){var t=e.isVisible,n=e.status;return t?a.a.createElement("div",{className:"fade-curtain"},a.a.createElement("div",{className:"loading-popup"},a.a.createElement(We,null),a.a.createElement("p",{className:"loading-popup__status"},n))):null},Ge=function(e){return o.a.t(e)};var Le=function(e){var t=e.type||"regular",n=e.disabled;return i.createElement("button",{id:e.id,className:"button button--".concat(n?"disabled":t," ").concat(e.className||""),onClick:n?null:e.onClick,disabled:n},Ge(e.text))},Re=function(e){return o.a.t(e)},Be=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).state={needAuth:!1},n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"sendCode",value:function(){var e=this,t=document.forms.auth.elements.code.value;Ie.sendCode(t).subscribe(function(t){"success"===t.response.status?Ee.publish(Oe.SHOW_NOTICE,{description:"gdrive.success.login",type:"success"}):Ee.publish(Oe.SHOW_NOTICE,{title:"error",description:"gdrive.error.code",type:"error"}),e.closePopup(),e.setState({needAuth:!1})},function(){Ee.publish(Oe.SHOW_NOTICE,{title:"error",description:"gdrive.error.unknown",type:"error"}),e.closePopup(),e.setState({needAuth:!1})})}},{key:"closePopup",value:function(){Ee.publish(Oe.TOGGLE_GDRIVE_POPUP,!1)}},{key:"authToGdrive",value:function(){var e=this;Ie.authorize().subscribe(function(t){var n=t.response,i=n.status;"success"===i?(Ee.publish(Oe.SHOW_NOTICE,{description:"gdrive.success.login",type:"success"}),e.closePopup()):"needAuth"===i?(window.open(n.link,"_blank"),e.setState({needAuth:!0})):(Ee.publish(Oe.SHOW_NOTICE,{title:"error",description:"gdrive.error.login",type:"error"}),e.closePopup())},function(){Ee.publish(Oe.SHOW_NOTICE,{title:"error",description:"gdrive.error.unknown",type:"error"}),e.closePopup()})}},{key:"logoutFromGdrive",value:function(){var e=this;Ie.logout().subscribe(function(t){"success"===t.response.status?Ee.publish(Oe.SHOW_NOTICE,{description:"gdrive.success.logout",type:"success"}):Ee.publish(Oe.SHOW_NOTICE,{title:"error",description:"gdrive.error.logout",type:"error"}),e.closePopup()},function(){Ee.publish(Oe.SHOW_NOTICE,{title:"error",description:"gdrive.error.unknown",type:"error"}),e.closePopup()})}},{key:"render",value:function(){var e=this;return this.props.isVisible?a.a.createElement("div",{className:"fade-curtain"},a.a.createElement("div",{className:"drive-popup"},a.a.createElement("span",{className:"close",onClick:function(){return e.closePopup()}},"\u2715"),this.state.needAuth?a.a.createElement("div",{className:"drive-popup--auth"},a.a.createElement("h3",null,Re("gdrive.paste")),a.a.createElement("form",{name:"auth"},a.a.createElement("textarea",{id:"code",name:"code"})),a.a.createElement("div",null,a.a.createElement(Le,{id:"submit-button",type:"primary",text:Re("gdrive.submit"),onClick:function(){return e.sendCode()}}))):a.a.createElement("div",{className:"drive-popup--main"},a.a.createElement("h3",null,Re("gdrive.title")),Ie.isLoggedIn?a.a.createElement("div",{className:"drive-popup--user"},a.a.createElement("img",{className:"drive-popup--user--photo",src:Ie.user.photo,alt:""}),a.a.createElement("p",{className:"drive-popup--user--name"},Ie.user.name),a.a.createElement("p",{className:"drive-popup--user--email"},Ie.user.email)):null,a.a.createElement("div",{className:"drive-popup--main--buttons"},a.a.createElement(Le,{id:"authorize-button",text:Re("gdrive.login"),type:"primary",disabled:Ie.isLoggedIn,onClick:function(){return e.authToGdrive()}}),a.a.createElement(Le,{id:"signout-button",disabled:!Ie.isLoggedIn,onClick:function(){return e.logoutFromGdrive()},text:Re("gdrive.logout")}))))):null}}]),t}(a.a.Component);function Me(){return(Me=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function Fe(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var He=function(e){var t=e.svgRef,n=e.title,i=Fe(e,["svgRef","title"]);return a.a.createElement("svg",Me({width:42,height:42,viewBox:"0 0 11.1125 11.1125",id:"svg1376",ref:t},i),a.a.createElement("title",null,n),a.a.createElement("g",{id:"layer1",transform:"translate(0,-285.8875)"},a.a.createElement("g",{id:"g1952"},a.a.createElement("rect",{y:285.88751,x:0,height:11.1125,width:11.1125,id:"rect1921",style:{fill:"#98dc77",fillOpacity:1,stroke:"none",strokeWidth:.79107171,strokeLinecap:"round",strokeLinejoin:"miter",strokeMiterlimit:4,strokeDasharray:"none",strokeDashoffset:0,strokeOpacity:1,paintOrder:"fill markers stroke"}}),a.a.createElement("g",{id:"g1946"},a.a.createElement("rect",{style:{fill:"#fffcfb",fillOpacity:1,stroke:"none",strokeWidth:.70830655,strokeLinecap:"round",strokeLinejoin:"miter",strokeMiterlimit:4,strokeDasharray:"none",strokeDashoffset:0,strokeOpacity:1,paintOrder:"fill markers stroke"},id:"rect1925",width:7.9375,height:1.0583333,x:0,y:287.21042}),a.a.createElement("circle",{style:{fill:"#fffcfb",fillOpacity:1,stroke:"none",strokeWidth:.71080917,strokeLinecap:"round",strokeLinejoin:"miter",strokeMiterlimit:4,strokeDasharray:"none",strokeDashoffset:0,strokeOpacity:1,paintOrder:"fill markers stroke"},id:"path1927",cx:8.2912483,cy:287.73959,r:1.0583333}))),a.a.createElement("rect",{style:{fill:"#fffffc",fillOpacity:1,stroke:"none",strokeWidth:.83807957,strokeLinecap:"round",strokeLinejoin:"miter",strokeMiterlimit:4,strokeDasharray:"none",strokeDashoffset:0,strokeOpacity:1,paintOrder:"fill markers stroke"},id:"rect1925-3",width:11.1125,height:1.0583333,x:0,y:294.88333}),a.a.createElement("rect",{style:{fill:"#ffffff",fillOpacity:1,stroke:"none",strokeWidth:.54299682,strokeLinecap:"round",strokeLinejoin:"miter",strokeMiterlimit:4,strokeDasharray:"none",strokeDashoffset:0,strokeOpacity:1,paintOrder:"fill markers stroke"},id:"rect1925-3-6",width:4.761652,height:1.0368136,x:-295.93829,y:6.3645663,transform:"matrix(0.00451945,-0.99998979,0.99999963,8.6460488e-4,0,0)"}),a.a.createElement("circle",{style:{fill:"#ffffff",fillOpacity:1,stroke:"none",strokeWidth:.62302125,strokeLinecap:"round",strokeLinejoin:"miter",strokeMiterlimit:4,strokeDasharray:"none",strokeDashoffset:0,strokeOpacity:1,paintOrder:"fill markers stroke"},id:"path1969",cx:5.5562501,cy:295.41251,r:1.0583333}),a.a.createElement("circle",{style:{fill:"#ffffff",fillOpacity:1,stroke:"none",strokeWidth:.62302125,strokeLinecap:"round",strokeLinejoin:"miter",strokeMiterlimit:4,strokeDasharray:"none",strokeDashoffset:0,strokeOpacity:1,paintOrder:"fill markers stroke"},id:"path1969-7",cx:5.5562501,cy:290.91458,r:1.0583333}),a.a.createElement("rect",{style:{fill:"#ffffff",fillOpacity:1,stroke:"none",strokeWidth:.54722649,strokeLinecap:"round",strokeLinejoin:"miter",strokeMiterlimit:4,strokeDasharray:"none",strokeDashoffset:0,strokeOpacity:1,paintOrder:"fill markers stroke"},id:"rect1925-3-6-5",width:4.7597623,height:1.0534469,x:5.61022,y:290.38065,transform:"matrix(0.99999947,0.00102738,0.00260132,0.99999662,0,0)"})))},Ue=a.a.forwardRef(function(e,t){return a.a.createElement(He,Me({svgRef:t},e))}),Ve=(n.p,function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).state={visible:!1,language:""},n.clickObserver=Object(ee.a)(document,"click"),n.clickSubscription=null,n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"changeLanguage",value:function(e){h.changeLanguage(e),Ne.a.set("lang",e,{path:"/",expires:7}),Ee.publish(Oe.SET_BOARD_STATE,Q.EDIT),this.setState({language:e}),this.state.visible&&this.toggleSelector()}},{key:"toggleSelector",value:function(){this.setState({visible:!this.state.visible})}},{key:"componentDidUpdate",value:function(e,t,n){var i=this;this.state.visible?this.clickSubscription=this.clickObserver.subscribe(function(){i.toggleSelector()}):this.clickSubscription&&(this.clickSubscription.unsubscribe(),this.clickSubscription=null)}},{key:"componentDidMount",value:function(){var e=Ne.a.get("lang");e?this.changeLanguage(e):this.changeLanguage(h.language)}},{key:"render",value:function(){var e,t=this,n=this.state.visible,i=this.state.language;return a.a.createElement("div",{className:"language",title:(e="select-language",o.a.t(e))},a.a.createElement("div",{className:"language--icon",onClick:function(){return t.toggleSelector()}},a.a.createElement("span",{className:"iconify","data-icon":"ic:baseline-language"})),a.a.createElement("li",{className:"language--list language--list--".concat(n?"visible":"hidden")},a.a.createElement("ul",{className:"language--list--option",onClick:function(){return t.changeLanguage("en")}},a.a.createElement("span",null,"English"),a.a.createElement("span",{className:"language--check language--check--".concat("en"===i?"visible":"hidden")},a.a.createElement("span",{className:"iconify","data-icon":"ant-design:check-outlined"}))),a.a.createElement("ul",{className:"language--list--option",onClick:function(){return t.changeLanguage("ru")}},a.a.createElement("span",null,"\u0420\u0443\u0441\u0441\u043a\u0438\u0439"),a.a.createElement("span",{className:"language--check language--check--".concat("ru"===i?"visible":"hidden")},a.a.createElement("span",{className:"iconify","data-icon":"ant-design:check-outlined"})))))}}]),t}(a.a.Component)),Je=function(e){return o.a.t(e)};function ze(e){var t=e.list.map(function(e,t){return a.a.createElement("li",{className:"suboptions__option",onClick:e.action,key:t},a.a.createElement("div",{className:"suboptions__name suboptions__entry"},Je(e.name)),a.a.createElement("div",{className:"suboptions__hotkey suboptions__entry"},e.hotkey?e.hotkey:null))});return a.a.createElement("ul",{className:"suboptions"},t)}var Ye=function(e){function t(){return Object(p.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props.options.map(function(e,t){return a.a.createElement("li",{className:"main-menu__option-list",key:t},a.a.createElement("div",{className:"main-menu__option"},Je(e.name)),a.a.createElement(ze,{list:e.suboptions}))});return a.a.createElement("ul",{className:this.props.className},e)}}]),t}(a.a.Component),Ze=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).state={inputVisible:!1},n.handleBlur=n.handleBlur.bind(Object(v.a)(n)),n.handleTitleClick=n.handleTitleClick.bind(Object(v.a)(n)),n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"handleTitleClick",value:function(){var e=document.getElementsByClassName("scheme-title__input")[0];this.setState({inputVisible:!0}),e.style.display="inline-block",e.focus()}},{key:"handleBlur",value:function(e){var t=e.target,n=t.value;t.style.display="none",this.setState({inputVisible:!1}),n&&this.props.setSchemeName(n)}},{key:"render",value:function(){var e=this,t=this.state.inputVisible;return a.a.createElement("div",{className:"main-menu__wrapper"},a.a.createElement("div",{className:"main-menu__section"},a.a.createElement("div",{className:"logo-block"},a.a.createElement(Ue,{className:"logo"})),a.a.createElement("div",{className:"menu-block"},a.a.createElement("div",{className:"scheme-title__wrapper",key:this.props.schemeName},a.a.createElement("h3",{className:"scheme-title scheme-title--".concat(t?"hidden":"visible"),onClick:this.handleTitleClick},this.props.schemeName),a.a.createElement("input",{className:"scheme-title__input",placeholder:"Scheme",defaultValue:this.props.schemeName,onBlur:function(t){return e.handleBlur(t)}})),a.a.createElement(Ye,{className:"main-menu",options:this.props.options}))),a.a.createElement("div",{className:"extras__section"},a.a.createElement(Ve,null)))}}]),t}(a.a.Component),Xe=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).actions=[{name:Q.EDIT,icon:"vaadin:cursor",title:"action.edit"},{name:Q.INTERACT,icon:"fa:hand-pointer-o",title:"action.interact"},{name:"create-button",icon:"twemoji:black-square-button",title:"action.create-button"},{name:"create-outContact",icon:"fxemoji:radiobutton",title:"action.create-out-contact"}],n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"execAction",value:function(e){"create-button"===e?(Ee.publish(Oe.SET_BOARD_STATE,Q.CREATE),Ee.publish(Oe.SET_CURRENT_ELEMENT,new ne)):"create-outContact"===e?(Ee.publish(Oe.SET_BOARD_STATE,Q.CREATE),Ee.publish(Oe.SET_CURRENT_ELEMENT,new ue)):Ee.publish(Oe.SET_BOARD_STATE,e)}},{key:"render",value:function(){var e=this,t=this.actions.map(function(t){return a.a.createElement("div",{className:"action-panel__action ".concat(t.name),key:t.name,title:(n=t.title,o.a.t(n)),onClick:function(){return e.execAction(t.name)}},a.a.createElement("div",{className:"iconify","data-icon":t.icon}));var n});return a.a.createElement("div",{className:"action-panel"},t)}}]),t}(a.a.Component),qe={fill:{name:"color",inputType:"color"},inContacts:{name:"in",inputType:"select",valueType:"range"},outContacts:{name:"Number of Out contacts",inputType:"select",valueType:"range"},initialSignal:{name:"initial-value",inputType:"select",valueType:"signal"},signal:{name:"current-value",inputType:"select",valueType:"signal"},invert:{name:"invert",inputType:"select",valueType:"answer"}},$e=function(e){return o.a.t(e)},Ke=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).className="element-details",n.currentProp=null,n.handleFocus=n.handleFocus.bind(Object(v.a)(n)),n.resetElementState=n.resetElementState.bind(Object(v.a)(n)),n.handleChange=n.handleChange.bind(Object(v.a)(n)),n.blurSubscription=null,n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"resetElementState",value:function(){var e=this.props.currentEl,t=this.currentProp,n=document.getElementsByName(this.currentProp),i=Object(ge.a)(n,1)[0];/invert\d+/.test(t)?e.setInPinInvertState(Number(t.match(/\d+/)[0])-1,"true"===i.value):("true"===i.value||"false"===i.value?e.props[t]="true"===i.value:isNaN(i.value)?e.props[t]=i.value:e.props[t]=Number(i.value),e.setProps(e.props)),Ee.publish(Oe.SET_CURRENT_ELEMENT,e),this.blurSubscription&&this.blurSubscription.unsubscribe()}},{key:"handleFocus",value:function(e,t){var n=e.target;this.currentProp=t,this.blurSubscription=Object(ee.a)(n,"blur").subscribe(this.resetElementState)}},{key:"handleChange",value:function(e,t){this.currentProp=t,this.resetElementState()}},{key:"generateOptions",value:function(e,t){var n,i=[],s=this.props.currentEl,r=function(e){return k.a.map(e,function(e){return a.a.createElement("option",{value:e,key:e},e)})};switch(e){case"signal":n=r([0,1]);break;case"range":if("inContacts"===t){for(var o=2;o<=s.maxContacts;o++)i.push(o);n=r(i)}break;case"answer":n=k.a.map(["no","yes"],function(e){var t="yes"===e;return a.a.createElement("option",{value:t,key:e},$e(e))});break;default:n=a.a.createElement("option",null,"Not specified")}return n}},{key:"getElementData",value:function(){var e=this,t=this.props.currentEl,n=Object.keys(t.props),i=k.a.get(t,"props.inContacts",null);if(i)for(var s=1;s<=i;s++)n.push("invert".concat(s));return n.map(function(n){var i="".concat(t.name,"_").concat(n),s=k.a.get(qe[n],"name",null),r=k.a.get(qe[n],"inputType",null),o=k.a.get(qe[n],"valueType",null),l=s?$e("props.".concat(s)):null;return/invert\d+/.test(n)&&(l=$e("props.".concat(qe.invert.name))+" "+n.match(/\d+/)[0],r=qe.invert.inputType,o=qe.invert.valueType),a.a.createElement("tr",{key:i,hidden:k.a.indexOf(w[n],t.name)>=0},a.a.createElement("td",{key:n},a.a.createElement("span",{className:"prop-name"},l||n)),a.a.createElement("td",{key:i},a.a.createElement("span",null,"select"!==r?a.a.createElement("input",{type:r||"text",defaultValue:t.props[n],onFocus:r?null:function(t){return e.handleFocus(t,n)},onChange:r?function(t){return e.handleChange(t,n)}:null,name:n,className:"prop-input",key:i}):a.a.createElement("select",{defaultValue:t.props[n],onChange:function(t){return e.handleChange(t,n)},name:n,className:"prop-input",key:i},e.generateOptions(o,n)))))})}},{key:"render",value:function(){if(this.props.currentEl&&!this.props.currentEl.id){var e=this.getElementData(),t=$e("elements.".concat(this.props.currentEl.name.toLowerCase()));return a.a.createElement("div",{className:"".concat(this.className,"__wrapper")},a.a.createElement("table",{className:this.className},a.a.createElement("caption",{className:"".concat(this.className,"__title")},o.a.t("properties",{element:t})),a.a.createElement("tbody",null,a.a.createElement("tr",null,a.a.createElement("th",null,$e("name")),a.a.createElement("th",null,$e("value"))),e)))}return null}}]),t}(a.a.Component),Qe=function(e){return o.a.t(e)},et=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).handleClick=function(e){Ee.publish(Oe.SET_BOARD_STATE,Q.CREATE),Ee.publish(Oe.SET_CURRENT_ELEMENT,e)},n.handleClick=n.handleClick.bind(Object(v.a)(n)),n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.props.elements.map(function(t,n){return a.a.createElement("div",{key:n,className:"element",title:Qe(t.name)||t,onClick:function(){return e.handleClick(t.create())}},a.a.createElement("img",{src:t.icon,alt:Qe(t.name)}))});return a.a.createElement("div",{className:this.props.className},t)}}]),t}(a.a.Component),tt=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).state={opened:!1},n.handleClick=n.handleClick.bind(Object(v.a)(n)),n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"handleClick",value:function(e){this.setState({opened:!this.state.opened})}},{key:"render",value:function(){var e=this.props,t=e.group,n=e.index;return a.a.createElement("div",{className:"".concat(this.props.className,"-").concat(this.state.opened?"opened":"closed"," ").concat(this.props.className)},a.a.createElement("div",{className:"details detail--".concat(n),onClick:this.handleClick},a.a.createElement("span",null,Qe(t.name)),a.a.createElement("div",{className:"arrow"})),a.a.createElement(et,{elements:t.elements,className:"elements-list",currentEl:this.props.currentEl}))}}]),t}(a.a.Component),nt=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).state={opened:!1},n.handleClick=n.handleClick.bind(Object(v.a)(n)),n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"handleClick",value:function(e){this.setState({opened:!this.state.opened})}},{key:"render",value:function(){var e=this,t=this.props.groups.map(function(t,n){return a.a.createElement(tt,{group:t,className:"".concat(e.props.className,"__group"),index:n,key:t.name,currentEl:e.props.currentEl})});return a.a.createElement("div",{className:this.props.className},t)}}]),t}(a.a.Component),it=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).sliderMoveObservable=Object(ee.a)(document,"mousemove"),n.mouseUpSliderObservable=Object(ee.a)(document,"mouseup"),n.sliderMoveSubscription=null,n.mouseUpSliderSubscription=null,n.menuInitialWidth=null,n.state={currentEl:null,originalData:null},n.handleMouseDown=n.handleMouseDown.bind(Object(v.a)(n)),n.mouseUp=n.mouseUp.bind(Object(v.a)(n)),n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"mouseMove",value:function(e,t){e.preventDefault();var n=e.pageX-t.pageX+t.curColumnWidth;if(e.pageX>t.width&&t.column.getBoundingClientRect().width>t.width?t.column.style.width="".concat(n,"px"):t.column.style.width="".concat(t.width,"px"),this.menuInitialWidth>n){var i=document.getElementsByClassName("board__container")[0].getBoundingClientRect(),a=i.width,s=i.height,r=ke.getFieldData().width,o=ke.getFieldData().height;Ee.publish(Oe.BOARD_RESIZE,{width:r>a?r:a,height:o>s?o:s}),this.menuInitialWidth=n}}},{key:"mouseUp",value:function(e){e.preventDefault(),this.sliderMoveSubscription.unsubscribe(),this.mouseUpSliderSubscription.unsubscribe()}},{key:"handleMouseDown",value:function(e){var t=this;e.preventDefault();var n={column:e.target.parentElement,curColumnWidth:e.target.parentElement.offsetWidth,pageX:e.pageX,width:e.target.offsetWidth+2,height:e.target.offsetHeight};this.sliderMoveSubscription=this.sliderMoveObservable.subscribe(function(e){return t.mouseMove(e,n)}),this.mouseUpSliderSubscription=this.mouseUpSliderObservable.subscribe(this.mouseUp)}},{key:"componentDidMount",value:function(){var e=document.getElementsByClassName("side-menu")[0];this.menuInitialWidth=e.getBoundingClientRect().width,Object(ee.a)(window,"resize").subscribe(function(t){var n=t.target.innerWidth,i=e.getBoundingClientRect().width,a=e.getBoundingClientRect().height,s=ke.getFieldData().width,r=ke.getFieldData().height;Ee.publish(Oe.BOARD_RESIZE,{width:s+i>n?s:n-i,height:r>a?r:a})})}},{key:"render",value:function(){return a.a.createElement("div",{className:"side-menu"},a.a.createElement("div",{className:"side-menu__section__wrapper"},a.a.createElement("div",{className:"side-menu__section"},a.a.createElement(nt,{groups:this.props.groups,className:"side-menu__section__list",currentEl:this.props.currentEl}),a.a.createElement(Ke,{currentEl:this.props.currentEl}))),a.a.createElement("div",{className:"side-menu__split-bar",onMouseDown:this.handleMouseDown}))}}]),t}(a.a.Component),at=function(e){return o.a.t(e)},st=["success","error","warning","default"];var rt=function(e){var t="notification--".concat(k.a.includes(st,e.type)?e.type:"default");return a.a.createElement("div",{className:"notification ".concat(t),key:e.id},a.a.createElement("div",{className:"notification--title"},at(e.title||"notice")),a.a.createElement("p",{className:"notification--description"},at(e.description)))};function ot(e){this.name="elements."+e.toLowerCase(),this.create=pe.getCreateFuncByName(e),this.icon=pe.getIconByName(e)}var lt=[{name:"groups.base",elements:[new ot("Or"),new ot("Nor"),new ot("And"),new ot("Nand"),new ot("Xor"),new ot("Nxor")]},{name:"groups.gates",elements:[new ot("Invertor"),new ot("Buffer")]},{name:"groups.io",elements:[new ot("Constant"),new ot("Button"),new ot("OutContact")]}],ct=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).coords={x:null,y:null,x1:null,y1:null},n.ghost=null,n.down=!1,n.junctionStartingFlag=!1,n.junctionEndingFlag=!1,n.wiresToBuild=null,n.startingEl=null,n.endingEl=null,n.elements=[],n.wires=[],n.isAnyElementActive=!1,n.eventSubscriptions=[],window.wires=n.wires,window.elements=n.elements,window.disableWireModels=function(){k.a.forEach(n.wires,function(e){e.model.stroke="#00000000"}),ke.render()},window.getAllWireModels=function(){k.a.forEach(n.wires,function(e){console.log(e.getElement())})},n.dragHandler=n.dragHandler.bind(Object(v.a)(n)),n.ghostHelper=n.ghostHelper.bind(Object(v.a)(n)),n.startWire=n.startWire.bind(Object(v.a)(n)),n.endWire=n.endWire.bind(Object(v.a)(n)),n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"getCoords",value:function(e){var t=this.board.getBoundingClientRect();return{x:e.pageX-t.left,y:e.pageY-t.top}}},{key:"calcCoords",value:function(e){e.x=12*Math.floor(e.x/12)+5,e.y=12*Math.floor(e.y/12)+5,this.coords.x=e.x,this.coords.y=e.y}},{key:"calcWireCoords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.x=12*Math.floor(e.x/12)+5,e.y=12*Math.floor(e.y/12)+5,t?(this.coords.x1=e.x,this.coords.y1=e.y):(this.coords.x=e.x,this.coords.y=e.y)}},{key:"startWire",value:function(e){e.preventDefault();var t=this.getCoords(e);this.down=!0,this.calcWireCoords(t,!0)}},{key:"deleteWire",value:function(e){var t=k.a.findIndex(this.wires,e);e.destroy(),ke.removeElementById(e.id),this.wires.splice(t,1)}},{key:"tryProlongWire",value:function(e){var t=this,n=e.inConnector,i=e.outConnector,a=this.wiresToBuild.main,s=!1,r=function(n){var i=n.el,r=k.a.get(i,"model.vertices[0].x"),o=k.a.get(i,"model.vertices[0].y"),l=k.a.get(i,"model.vertices[1].x"),c=k.a.get(i,"model.vertices[1].y");if("Wire"===i.className&&(a.x2===r||a.y2===o)){if(a.x2===r){var u=Math.min(a.y1,a.y2,o,c),h=Math.max(a.y1,a.y2,o,c);o>c?(a.y2=u,a.y1=h):(a.y1=u,a.y2=h)}else{var p=Math.min(a.x1,a.x2,r,l),d=Math.max(a.x1,a.x2,r,l);r<l?(a.x1=p,a.x2=d):(a.x2=p,a.x1=d)}s=!0,"in"===n.type?e.outConnector=i.outConnector:e.inConnector=i.inConnector,t.deleteWire(i)}};return n&&r(n),i&&r(i),s}},{key:"revertChain",value:function(e,t,n){for(var i=[t],a=t;a.inConnector&&"Wire"===k.a.get(a,"inConnector.el.name",null);a=a.inConnector.el)i.push(a.inConnector.el);"Junction"===k.a.get(n,"name",null)&&n.removeWire(i[i.length-1]);for(var s=k.a.map(i,function(){var e=new ve;return e.className="Wire",e}),r=s.length,o=0;o<r;o++){var l=i[o].getCoords(),c=s[o];0===o?(c.inConnector={el:e,pin:0,type:"out"},c.outConnector=r>1?{el:s[o+1],pin:0,type:"in"}:n?{el:n,pin:0,type:"in"}:null):o===r-1?(c.inConnector={el:s[o-1],pin:0,type:"out"},c.outConnector=n?{el:n,pin:0,type:"in"}:null):(c.inConnector={el:s[o-1],pin:0,type:"out"},c.outConnector={el:s[o+1],pin:0,type:"in"}),this.deleteWire(i[o]),ke.renderWire(c,l.x1,l.y1,l.x2,l.y2),this.wires.push(c),this.applyHelpers(c)}k.a.forEach(s,function(e){e.wire()}),e.outConnector={el:s[0],pin:0,type:"in"},"Junction"===k.a.get(n,"name",null)&&n.pushWire(s[r-1])}},{key:"endWire",value:function(e){e.preventDefault();var t=new ve,n=new ve,i=this.startingEl,a=this.endingEl,s=new ae,r=new ae;if(t.className="Wire",n.className="Wire",this.wiresToBuild){var o=this.wiresToBuild.main,l=this.wiresToBuild.bend;if(o&&(i||a)){var c,u;if(i.el.id!==a.el.id||i.pin!==a.pin||i.type!==a.type){if("out"===i.type?t.inConnector=k.a.clone(i):"in"===i.type&&(t.outConnector=k.a.clone(i)),"out"===a.type?t.inConnector=k.a.clone(a):"in"===a.type&&(t.outConnector=k.a.clone(a)),"Junction"===i.el.name&&i.el.pushWire(t),this.junctionStartingFlag&&(s.setId(),s.pushWire(t)),this.junctionEndingFlag&&!l&&(r.setId(),r.pushWire(t)),i.type===a.type)"Wire"===k.a.get(i,"el.name",null)?(u=i.el,c=i.el.getCurrentSignalSource(),t.inConnector=k.a.clone(a)):"Wire"===k.a.get(a,"el.name",null)&&(u=a.el,c=a.el.getCurrentSignalSource(),t.inConnector=k.a.clone(i)),c&&u?"Junction"===k.a.get(c,"el.name",null)&&this.revertChain(t,u,c.el):(o=null,l=null)}else"out"===i.type?t.inConnector=k.a.clone(i):"in"===i.type&&(t.outConnector=k.a.clone(i)),"Junction"===i.el.name&&i.el.pushWire(t),this.junctionStartingFlag&&(s.setId(),s.pushWire(t)),this.junctionEndingFlag&&!l&&(r.setId(),r.pushWire(t));if(o&&(o.x1!==o.x2&&2!==Math.abs(o.y1-o.y2)||o.x1===o.x2&&o.y1!==o.y2)&&(this.tryProlongWire(t),ke.renderWire(t,o.x1,o.y1,o.x2,o.y2),this.wires.push(t),l||(t.wire(),this.applyHelpers(t))),l&&(t.outConnector&&t.inConnector?"in"===i.type?(n.inConnector=t.inConnector,n.outConnector=k.a.clone({el:t,pin:0,type:"in"}),t.inConnector=k.a.clone({el:n,pin:0,type:"out"})):(n.outConnector=t.outConnector,n.inConnector=k.a.clone({el:t,pin:0,type:"out"}),t.outConnector=k.a.clone({el:n,pin:0,type:"in"})):t.outConnector&&!t.inConnector?(t.inConnector=k.a.clone({el:n,pin:0,type:"out"}),n.outConnector=k.a.clone({el:t,pin:0,type:"in"})):(n.inConnector=k.a.clone({el:t,pin:0,type:"out"}),t.outConnector=k.a.clone({el:n,pin:0,type:"in"})),this.junctionEndingFlag&&(r.setId(),r.pushWire(n)),this.wires.push(n),ke.renderWire(n,l.x1,l.y1,l.x2,l.y2),n.wire(),t.wire(),this.applyHelpers(t),this.applyHelpers(n)),this.junctionStartingFlag){var h=this.startingEl.el.getCoords();ke.renderJunction(s,"horizontal"===h.orientation?o.x1:h.x1,"horizontal"===h.orientation?h.y1:o.y1),this.elements.push(s),this.sliceWire(this.startingEl.el,s),s.enableOutPinHelper(0),ke.render(),this.applyHelpers(s)}if(this.junctionEndingFlag){var p=this.endingEl.el.getCoords(),d=l?n.getCoords():t.getCoords();ke.renderJunction(r,"horizontal"===p.orientation?d.x1:p.x1,"horizontal"===p.orientation?p.y1:d.y2),this.elements.push(r),this.sliceWire(this.endingEl.el,r),r.enableOutPinHelper(0),ke.render(),this.applyHelpers(r)}ke.removeElement({className:"main"}),ke.removeElement({className:"bend"})}this.updateGlobalData()}this.down=!1,this.startingEl=null,this.endingEl=null,this.junctionStartingFlag=!1,this.junctionEndingFlag=!1,this.props.state===Q.WIRE&&Ee.publish(Oe.SET_BOARD_STATE,Q.EDIT)}},{key:"updateGlobalData",value:function(){Ee.publish(Oe.UPDATE_DATA,{schemeName:this.props.data.schemeName,elements:this.elements,wires:this.wires})}},{key:"sliceWire",value:function(e,t){var n=this,i=k.a.get(e.inConnector,"el",null),a=k.a.get(e.outConnector,"el",null),s=e.getCoords(),r=t.getCoords(),o=new ve,l=new ve,c=k.a.findIndex(this.wires,e),u=function(u,h){var p={},d={},m=k.a.get(i,"name",null);"horizontal"===s.orientation?u.x1>h.x1?(p={x1:Math.max(s.x1,s.x2),y1:s.y1,x2:r.x1-1,y2:r.y1},d={x1:r.x1+1,y1:r.y1,x2:Math.min(s.x1,s.x2),y2:s.y1}):(p={x1:Math.min(s.x1,s.x2),y1:s.y1,x2:r.x1+1,y2:r.y1},d={x1:r.x1-1,y1:r.y1,x2:Math.max(s.x1,s.x2),y2:s.y1}):u.y1<h.y1?(p={x1:s.x1,y1:Math.min(s.y1,s.y2),x2:r.x1,y2:r.y1+2},d={x1:r.x1,y1:r.y1-1,x2:s.x1,y2:Math.max(s.y1,s.y2)}):(p={x1:s.x1,y1:Math.max(s.y1,s.y2),x2:r.x1,y2:r.y1-2},d={x1:r.x1,y1:r.y1+1,x2:s.x1,y2:Math.min(s.y1,s.y2)});var f=Math.max(Math.abs(p.x1-p.x2),Math.abs(p.y1-p.y2)),v=Math.max(Math.abs(d.x1-d.x2),Math.abs(d.y1-d.y2));return(f>5&&v>5||"Wire"!==m)&&(n.deleteWire(e),o.inConnector=e.inConnector,o.outConnector=e.inConnector?{el:t,pin:0,type:"in"}:null,!e.getCurrentSignalSource()&&e.inConnector&&n.revertChain(o,e.inConnector.el,null),l.inConnector={el:t,pin:0,type:"out"},l.outConnector=e.outConnector,ke.renderWire(o,p.x1,p.y1,p.x2,p.y2),ke.renderWire(l,d.x1,d.y1,d.x2,d.y2),n.applyHelpers(o),n.applyHelpers(l),n.wires.splice(c,0,o),n.wires.splice(c,0,l),t.pushWire(o),t.pushWire(l),o.wire(),l.wire(),"Junction"===k.a.get(a,"name",null)&&(a.removeWire(e),a.pushWire(l)),t.updateState(),!0)};if(o.className="Wire",l.className="Wire",i&&a)u(i.getCoords(),a.getCoords());else if(i){var h=i.getCoords(),p=Math.abs(h.x1-s.x1),d=Math.abs(h.x1-s.x2),m=Math.abs(h.y1-s.y1),f=Math.abs(h.y1-s.y2);u(h,{x1:Math.max(p,d)===p?s.x1:s.x2,y1:Math.max(m,f)===p?s.x1:s.x2})}else if(a){var v=a.getCoords(),g=Math.abs(v.x1-s.x1),b=Math.abs(v.x1-s.x2),y=Math.abs(v.y1-s.y1),E=Math.abs(v.y1-s.y2);u({x1:Math.max(g,b)===g?s.x1:s.x2,y1:Math.max(y,E)===g?s.x1:s.x2},v)}}},{key:"dragHandler",value:function(e){e.preventDefault();var t=k.a.cloneDeep(this.props.currentEl),n=ke.getFieldData().width,i=ke.getFieldData().height;ke.renderElement(t,this.coords.x,this.coords.y),this.elements.push(t),t.setId(),t.updateState(),this.applyHelpers(t),this.updateGlobalData(),Ee.publish(Oe.BOARD_RESIZE,{width:t.x+t.width>n?n+2*t.width:n,height:t.y+t.height>i?i+2*t.height:i}),t.model._renderer.elem.scrollIntoView()}},{key:"applyHelpers",value:function(e){var t=this,n=function(n,i){return function(a,s){var r=k.a.get(a,"helper._renderer.elem",null);if(r){var o=Object(ee.a)(r,"mousemove").subscribe(function(){t.props.state!==Q.EDIT&&t.props.state!==Q.WIRE||!a.helperEnabled||(a.helper.opacity=1,ke.render(),i(e,s))}),l=Object(ee.a)(r,"mousedown").subscribe(function(){t.props.state===Q.EDIT&&a.helperEnabled&&(Ee.publish(Oe.SET_BOARD_STATE,Q.WIRE),n(e,s))}),c=Object(ee.a)(r,"mouseout").subscribe(function(){t.props.state!==Q.EDIT&&t.props.state!==Q.WIRE||!a.helperEnabled||(a.helper.opacity=0,ke.render(),t.endingEl=t.startingEl)});e.addSubscription(o,l,c)}}},i=this;if(e.outPins&&k.a.forEach(e.outPins.pins,n(function(e,t){i.startingEl={el:e,pin:t,type:"out"}},function(e,t){i.endingEl={el:e,pin:t,type:"out"}})),e.inPins&&k.a.forEach(e.inPins.pins,n(function(e,t){i.startingEl={el:e,pin:t,type:"in"}},function(e,t){i.endingEl={el:e,pin:t,type:"in"}})),k.a.forEach(e.junctionHelpers,function(n){var i=n._renderer.elem,a=Object(ee.a)(i,"mousemove").subscribe(function(){if(t.props.state===Q.EDIT||t.props.state===Q.WIRE){var i=k.a.get(t.startingEl,"el.id",null),a=k.a.get(t.endingEl,"el.id",null);n.opacity=1,ke.render(),t.endingEl={el:e,pin:0,type:null},t.junctionEndingFlag=i&&a&&i!==a}}),s=Object(ee.a)(i,"mouseout").subscribe(function(){t.props.state!==Q.EDIT&&t.props.state!==Q.WIRE||(n.opacity=0,ke.render(),t.junctionEndingFlag=!1,t.endingEl=t.startingEl)}),r=Object(ee.a)(i,"mousedown").subscribe(function(){if(t.props.state===Q.EDIT){Ee.publish(Oe.SET_BOARD_STATE,Q.WIRE),t.startingEl={el:e,pin:0,type:null},t.junctionStartingFlag=!0;var n=Object(ee.a)(i,"mouseup").subscribe(function(){t.junctionStartingFlag=!1,t.startingEl=null,t.endingEl=null,n.unsubscribe()})}});e.addSubscription(r,a,s)}),"Wire"===e.name){var a=e.modelGroup._renderer.elem,s=Object(ee.a)(a,"click").subscribe(function(n){if(n.preventDefault(),t.props.state===Q.EDIT){e.model.className+=" element-active";var i=Object(ee.a)(document,"keydown").subscribe(function(n){46===n.keyCode&&(t.deleteWire(e),ke.eraseActiveZone(),i.unsubscribe())}),a=Object(ee.a)(document,"mousedown").subscribe(function(n){n.target.matches(".element-active, .element-active *")||(e.model.className=e.model.className.replace(" element-active",""),e.active=!1,t.isAnyElementActive=!1,ke.eraseActiveZone(),a.unsubscribe(),i.unsubscribe())});ke.renderActiveWireZone(e)}});e.addSubscription(s)}if("Junction"!==e.name&&"Wire"!==e.name){var r=e.model._renderer.elem,o=Object(ee.a)(r,"click").subscribe(function(n){if(n.preventDefault(),t.props.state===Q.EDIT){e.model.className+=" element-active",e.active=!0,t.isAnyElementActive=!0,Ee.publish(Oe.SET_CURRENT_ELEMENT,e);var i=Object(ee.a)(document,"keydown").subscribe(function(n){46===n.keyCode&&(t.deleteElement(e),ke.eraseActiveZone(),i.unsubscribe())}),a=Object(ee.a)(document,"mousedown").subscribe(function(n){n.target.matches(".element-active, .element-active *")||(e.model.className=e.model.className.replace(" element-active",""),r.style.cursor="default",e.active=!1,t.isAnyElementActive=!1,ke.eraseActiveZone(),a.unsubscribe(),i.unsubscribe())});ke.renderActiveZone(e)}}),l=Object(ee.a)(r,"mousedown").subscribe(function(){if(e.active&&t.props.state===Q.EDIT){var n=k.a.cloneDeep(t.props.currentEl),i=!1;n.className="ghost",n.props.opacity=.5,t.ghost=n,r.style.cursor="grabbing";var a=Object(ee.a)(document,"mousemove").subscribe(function(n){i=!0,t.ghostHelper(n),t.deleteElement(e),ke.eraseActiveZone()}),s=Object(ee.a)(document,"mouseup").subscribe(function(e){i?t.dragHandler(e):r.style.cursor="grab",s.unsubscribe(),a.unsubscribe()})}});e.addSubscription(o,l)}}},{key:"deleteElement",value:function(e){var t=k.a.findIndex(this.elements,e);e.destroy(),ke.removeElementById(e.id),this.elements.splice(t,1)}},{key:"orientationCorrection",value:function(e,t,n,i){return e===n?(e++,n++,t<i?i+=2:t+=2):t===i&&(t++,i++,e<n?n+=2:e+=2),[e,t,n,i]}},{key:"ghostHelper",value:function(e){e.preventDefault();var t=this.ghost,n=this.getCoords(e);if(t&&(this.props.state===Q.CREATE||this.isAnyElementActive)&&(this.calcCoords(n),ke.removeElement(t),ke.renderGhost(t,n.x,n.y)),this.props.state===Q.WIRE&&this.down){var i=new ve,a=new ve;i.className="main",a.className="bend";var s=ke.getElement(i);this.calcWireCoords(n),ke.removeElement(i),ke.removeElement(a);var r=this.coords.x1,o=this.coords.y1,l=this.coords.x,c=this.coords.y;if(o!==c&&r!==l){var u,h,p,d,m,f,v,g;s.length>0&&s[0].vertices[0].x===s[0].vertices[1].x?(u=r,h=o,p=r,d=c,m=r,f=c,v=l,g=c):(u=r,h=o,p=l,d=o,m=l,f=o,v=l,g=c);var b=this.orientationCorrection(u,h,p,d),y=Object(ge.a)(b,4);u=y[0],h=y[1],p=y[2],d=y[3];var E=this.orientationCorrection(m,f,v,g),O=Object(ge.a)(E,4);m=O[0],f=O[1],v=O[2],g=O[3],ke.renderWire(i,u,h,p,d,!1),ke.renderWire(a,m,f,v,g),this.wiresToBuild={main:{x1:u,y1:h,x2:p,y2:d},bend:{x1:m,y1:f,x2:v,y2:g}}}else{var k=this.orientationCorrection(r,o,l,c),C=Object(ge.a)(k,4);r=C[0],o=C[1],l=C[2],c=C[3],ke.renderWire(i,r,o,l,c),this.wiresToBuild={main:{x1:r,y1:o,x2:l,y2:c}}}}}},{key:"resetComponent",value:function(){this.board&&(this.ghost&&(ke.removeElement(this.ghost),ke.render()),this.ghost=null,k.a.forEach(this.eventSubscriptions,function(e){e.unsubscribe()}),this.eventSubscriptions=[])}},{key:"loadData",value:function(){var e=Object(E.a)(y.a.mark(function e(t){var n,i,a=this;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.elements,i=t.wires,k.a.forEach(n,function(e){a.applyHelpers(e),a.elements.push(e)}),k.a.forEach(i,function(e){a.applyHelpers(e),a.wires.push(e)}),window.wires=this.wires,window.elements=this.elements;case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resetData",value:function(){this.wires=[],this.elements=[]}},{key:"setBoardState",value:function(){switch(this.resetComponent(),L.boardState=this.props.state,this.props.state){case Q.WIRE:this.eventSubscriptions.push(Object(ee.a)(this.board,"mousemove").subscribe(this.ghostHelper),Object(ee.a)(this.board,"mousedown").subscribe(this.startWire),Object(ee.a)(this.board,"mouseup").subscribe(this.endWire));break;case Q.EDIT:break;case Q.CREATE:this.eventSubscriptions.push(Object(ee.a)(this.board,"mousemove").subscribe(this.ghostHelper),Object(ee.a)(this.board,"click").subscribe(this.dragHandler));var e=k.a.cloneDeep(this.props.currentEl);e.className="ghost",e.props.opacity=.5,this.ghost=e;break;case Q.DISABLE_MODELING:var t=document.getElementsByTagName("text"),n=document.getElementsByClassName("junction-circle"),i=document.querySelectorAll("#board svg *"),a=[],s=[],r=[];k.a.forEach(t,function(e){var t=window.getComputedStyle(e).getPropertyValue("fill");s.push(t),e.setAttribute("fill","#000")}),k.a.forEach(n,function(e){var t=window.getComputedStyle(e).getPropertyValue("fill");r.push(t),e.setAttribute("fill","#000")}),k.a.forEach(i,function(e){var t=window.getComputedStyle(e).getPropertyValue("stroke");a.push(t),"none"!==t&&e.setAttribute("stroke","#000")}),Ee.publish(Oe.MODELING_OFF,!0),k.a.forEach(t,function(e,t){e.setAttribute("fill",s[t])}),k.a.forEach(n,function(e,t){e.setAttribute("fill",r[t])}),k.a.forEach(i,function(e,t){"none"!==window.getComputedStyle(e).getPropertyValue("stroke")&&e.setAttribute("stroke",a[t])});break;case Q.LOAD_DATA:this.resetData(),this.loadData(this.props.data).then(function(){Ee.publish(Oe.SET_BOARD_STATE,Q.EDIT),Ee.publish(Oe.TOGGLE_LOADING,{toggle:!1})})}}},{key:"componentDidMount",value:function(){this.board=document.getElementById("board"),ke.init(this.board),window.renderer=ke,Object(ee.a)(this.board,"mousedown").subscribe(function(e){e.preventDefault()})}},{key:"render",value:function(){return this.setBoardState(),a.a.createElement("div",{className:"board__container"},a.a.createElement("div",{className:"board board--".concat(this.props.state),id:"board"}))}}]),t}(a.a.Component),ut=function(e){function t(){return Object(p.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(d.a)(t,[{key:"handleChange",value:function(e){var t=e.target.files[0];t&&(Ee.publish(Oe.TOGGLE_LOADING,{toggle:!0,status:"Loading scheme"}),Se.loadFile(t).subscribe(function(e){Ee.publish(Oe.UPDATE_DATA,e),setTimeout(function(){Ee.publish(Oe.SET_BOARD_STATE,Q.LOAD_DATA)},100)}))}},{key:"render",value:function(){var e=this;return i.createElement("input",{className:"file-input",id:"file-input",type:"file",accept:".dcb",onChange:function(t){return e.handleChange(t)}})}}]),t}(i.Component),ht=function(e){return o.a.t(e)},pt=function(e){function t(){return Object(p.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.props.currentEntry,n=this.props.warning,i=k.a.map(this.props.files,function(n){return a.a.createElement("tr",{className:"fs--table--row ".concat(n.id===t.id?"fs--table--row--selected":""),key:n.id,onClick:function(){return e.props.setCurrentEntry(n)},onDoubleClick:function(){return e.props.goDeep(n)}},a.a.createElement("td",{className:"fs--table--icon"},a.a.createElement("span",{className:"iconify","data-icon":"ant-design:".concat(n.type,"-outlined")})),a.a.createElement("td",{className:"fs--table--entry"},n.name))});return 0===this.props.files.length?n?a.a.createElement("p",null,n):a.a.createElement("p",null,ht("gdrive.fs.empty")):a.a.createElement("table",{className:"fs--table"},a.a.createElement("tbody",null,i))}}]),t}(a.a.Component),dt=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).state={loading:!1,path:[{name:"drive:/",type:"folder",id:"root"}],currentEntry:{name:"drive:/",type:"folder",id:"root"},files:[],warningMsg:null},n.navigateToLoginPopup=n.navigateToLoginPopup.bind(Object(v.a)(n)),n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"navigateToLoginPopup",value:function(){this.close(),Ee.publish(Oe.TOGGLE_GDRIVE_POPUP,!0)}},{key:"close",value:function(){Ee.publish(Oe.TOGGLE_FILE_BROWSER,{state:!1,mode:""})}},{key:"openFile",value:function(){var e=this.state.currentEntry;this.close(),Ee.publish(Oe.TOGGLE_LOADING,{toggle:!0,status:o.a.t("loading-file",{file:e.name})}),Ie.getFile(e.id).subscribe(function(t){var n=t.response,i=n.status,a=n.fileData;if("success"===i){var s=JSON.parse(a);Se.loadData(s,e.name).then(function(e){Ee.publish(Oe.UPDATE_DATA,e),setTimeout(function(){Ee.publish(Oe.SET_BOARD_STATE,Q.LOAD_DATA)},100)})}else"auth"===i?(Ee.publish(Oe.TOGGLE_LOADING,{toggle:!1}),Ee.publish(Oe.SHOW_NOTICE,{description:"Please sign in to Google Drive",type:"warning"})):(Ee.publish(Oe.TOGGLE_LOADING,{toggle:!1}),Ee.publish(Oe.SHOW_NOTICE,{description:"Error loading file",type:"error"}))},function(){Ee.publish(Oe.TOGGLE_LOADING,{toggle:!1}),Ee.publish(Oe.SHOW_NOTICE,{description:"Error loading file",type:"error"})})}},{key:"saveFile",value:function(){var e=this.props.schemeData,t=this.state.currentEntry;this.close(),Ie.saveFile(e,t.id).subscribe(function(e){var t=e.response.status;"success"===t?Ee.publish(Oe.SHOW_NOTICE,{description:"File saved to Google Drive",type:"success"}):"auth"===t?Ee.publish(Oe.SHOW_NOTICE,{description:"Please sign in to Google Drive",type:"warning"}):Ee.publish(Oe.SHOW_NOTICE,{description:"Error saving file to Google Drive",type:"error"})},function(){Ee.publish(Oe.SHOW_NOTICE,{description:"Error saving file to Google Drive",type:"error"})})}},{key:"goUp",value:function(){var e=this.state.path;e.pop(),this.setState({path:e}),this.setFolder(k.a.last(e).id),this.setCurrentEntry(k.a.last(e))}},{key:"goDeep",value:function(e){var t=this.state.path;"file"!==e.type?(t.push(e),this.setState({path:t}),this.setFolder(e.id)):this.openFile()}},{key:"setCurrentEntry",value:function(e){this.setState({currentEntry:e})}},{key:"setFolder",value:function(e){var t=this,n=this.props.mode||"open";this.setState({loading:!0}),Ie.listFiles(e).subscribe(function(e){if("success"===e.response.status){var i=k.a.map(e.response.files,function(e){var t=e.name;return{id:e.id,name:t,type:/.+\.dcb/.test(t)?"file":"folder"}});"save"===n&&(i=k.a.filter(i,["type","folder"])),t.setState({loading:!1,files:i})}})}},{key:"componentDidMount",value:function(){Ie.isLoggedIn?this.setFolder(k.a.last(this.state.path).id):this.setState({warningMsg:a.a.createElement("span",{className:"false-link",onClick:this.navigateToLoginPopup},ht("gdrive.fs.login-message"))})}},{key:"render",value:function(){var e=this,t=this.state,n=t.path,i=t.files,s=t.loading,r=t.currentEntry,o=this.props.mode||"open",l=k.a.reduce(n,function(e,t){return e+(t.name+"/")},""),c="drive://"===l,u=s,h="save"===o?"folder":"file";return a.a.createElement("div",{className:"fade-curtain"},a.a.createElement("div",{className:"fs__popup"},a.a.createElement("span",{className:"close",onClick:function(){return e.close()}},"\u2715"),a.a.createElement("div",{className:"fs__area"},a.a.createElement("div",{className:"fs__top"},a.a.createElement("div",{className:"fs__top--path"},l,"\u200e"),a.a.createElement("div",{className:"fs__top--back fs__top--back".concat(c||u?"--disabled":"--enabled"),title:ht("gdrive.fs.upper"),onClick:c?k.a.noop:function(){return e.goUp()}},a.a.createElement("span",{className:"iconify","data-icon":"entypo:back"}))),a.a.createElement("div",{className:"fs__content fs__content".concat(u||0===i.length?"--center":"")},u?a.a.createElement(We,null):a.a.createElement(pt,{files:i,currentEntry:r,setCurrentEntry:function(t){return e.setCurrentEntry(t)},goDeep:function(t){return e.goDeep(t)},warning:this.state.warningMsg})),a.a.createElement("div",{className:"fs__bottom"},"open"===this.props.mode?a.a.createElement(Le,{text:"main-menu.options.file.open",type:"primary",className:"fs__bottom--close",onClick:function(){return e.openFile()},disabled:r.type!==h}):a.a.createElement(Le,{text:"main-menu.options.file.save",type:"primary",className:"fs__bottom--close",onClick:function(){return e.saveFile()},disabled:r.type!==h||!Ie.isLoggedIn})))))}}]),t}(a.a.Component),mt=function(e){return o.a.t(e)},ft=function(e){function t(e){var n;return Object(p.a)(this,t),n=Object(m.a)(this,Object(f.a)(t).call(this,e)),k.a.forEach(k.a.values(Oe),function(e){return Ee.createEvent(e)}),n.state={currentEl:null,boardState:null,isLoading:!1,loadingStatus:"",isDrivePopupVisible:!1,fsOpened:!1,fsMode:"",language:"en",notice:{title:"",description:"",type:null,visible:!1},data:{schemeName:"Scheme",elements:null,wires:null}},n.notificationCounter=0,n.save=n.save.bind(Object(v.a)(n)),n.newFile=n.newFile.bind(Object(v.a)(n)),n.manageGdrive=n.manageGdrive.bind(Object(v.a)(n)),n.toggleFs=n.toggleFs.bind(Object(v.a)(n)),n.options=[{name:"main-menu.file",suboptions:[{name:"main-menu.options.file.new",action:n.newFile},{name:"main-menu.options.file.open",action:n.open},{name:"main-menu.options.file.save",action:n.save}]},{name:"Google Drive",suboptions:[{name:"gdrive.manage",action:n.manageGdrive},{name:"main-menu.options.file.open",action:function(){return n.toggleFs(!0,"open")}},{name:"main-menu.options.file.save",action:function(){return n.toggleFs(!0,"save")}}]},{name:"main-menu.export",suboptions:[{name:"main-menu.options.save-as-svg",action:function(){return Se.saveAsSVG(n.state.data.schemeName)}},{name:"main-menu.options.save-as-png",action:function(){return Se.saveAsPNG(n.state.data.schemeName)}}]}],n.handleChange=n.handleChange.bind(Object(v.a)(n)),n.updateData=n.updateData.bind(Object(v.a)(n)),n.setSchemeName=n.setSchemeName.bind(Object(v.a)(n)),n.toggleLoading=n.toggleLoading.bind(Object(v.a)(n)),n.showNotice=n.showNotice.bind(Object(v.a)(n)),Ee.subscribe(Oe.SET_BOARD_STATE,n.setBoardState.bind(Object(v.a)(n))),Ee.subscribe(Oe.UPDATE_DATA,n.updateData.bind(Object(v.a)(n))),Ee.subscribe(Oe.TOGGLE_LOADING,function(e){var t=e.toggle,i=e.status;n.toggleLoading(t,i)}),Ee.subscribe(Oe.SHOW_NOTICE,n.showNotice.bind(Object(v.a)(n))),Ee.subscribe(Oe.TOGGLE_GDRIVE_POPUP,n.manageGdrive),Ee.subscribe(Oe.TOGGLE_FILE_BROWSER,function(e){var t=e.state,i=e.mode;n.toggleFs(t,i)}),Ee.subscribe(Oe.SET_CURRENT_ELEMENT,n.handleChange.bind(Object(v.a)(n))),n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"manageGdrive",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setState({isDrivePopupVisible:e})}},{key:"open",value:function(){Se.openFile()}},{key:"toggleFs",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;this.setState({fsOpened:e,fsMode:t})}},{key:"componentDidMount",value:function(){var e=this;Ie.checkSession().subscribe(function(t){"success"===t.response.status&&e.showNotice({description:"gdrive.success.login",type:"success"})},function(){e.showNotice({title:"warning",description:"gdrive.error.unknown",type:"warning"})})}},{key:"newFile",value:function(){this.setState({data:{schemeName:"Scheme",elements:null,wires:null}}),Se.newFile()}},{key:"save",value:function(){var e=this.state.data;Se.saveFile(e)}},{key:"handleChange",value:function(e){this.setState({currentEl:e})}},{key:"toggleLoading",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"loading";this.setState({isLoading:e,loadingStatus:mt(t||"loading")})}},{key:"setBoardState",value:function(e){this.setState({boardState:e})}},{key:"setSchemeName",value:function(e){var t=this.state.data,n=t.wires,i=t.elements;this.setState({data:{schemeName:e,elements:i,wires:n}})}},{key:"updateData",value:function(e){this.setState({data:e})}},{key:"showNotice",value:function(e){var t=e.title,n=e.description,i=e.type;this.setState({notice:{type:i,title:t,description:n,id:this.notificationCounter++,visible:!0}})}},{key:"render",value:function(){return a.a.createElement("div",{className:"app"},this.state.notice.visible?a.a.createElement(rt,{title:this.state.notice.title,description:this.state.notice.description,type:this.state.notice.type,id:this.state.notice.id}):null,this.state.fsOpened?a.a.createElement(dt,{mode:this.state.fsMode,schemeData:this.state.data}):null,a.a.createElement(Ae,{isVisible:this.state.isLoading,status:this.state.loadingStatus}),a.a.createElement(Be,{isVisible:this.state.isDrivePopupVisible}),a.a.createElement(Ze,{options:this.options,setSchemeName:this.setSchemeName,schemeName:this.state.data.schemeName}),a.a.createElement(Xe,null),a.a.createElement("div",{className:"drawing-area"},a.a.createElement(it,{className:"side-menu",groups:lt,currentEl:this.state.currentEl}),a.a.createElement(ct,{currentEl:this.state.currentEl,state:this.state.boardState,data:this.state.data})),a.a.createElement(ut,null))}}]),t}(a.a.Component);r.a.render(a.a.createElement(ft,null),document.getElementById("root"))}},[[47,1,2]]]);
//# sourceMappingURL=main.350266e8.chunk.js.map